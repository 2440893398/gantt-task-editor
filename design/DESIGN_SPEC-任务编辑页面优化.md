# 设计规范文档 - 任务编辑页面优化
## Design Specification Document - Task Editing Enhancement

**文档版本**: v1.0
**创建时间**: 2026-01-05
**设计师**: AI UI/UX设计师
**关联PRD**: PRD-任务编辑页面优化-需求分析阶段.md

---

## 1. 设计概述

### 1.1 设计目标
基于现有甘特图系统的设计语言,优化任务编辑体验,让用户能够更高效、直观地管理任务信息,减少操作成本和认知负担。

### 1.2 设计理念
- **效率优先**: 通过内联编辑和优化的弹窗布局减少用户操作步骤
- **即时反馈**: 所有操作都有明确的视觉反馈,让用户清楚了解系统状态
- **渐进呈现**: 信息分层展示,避免一次性呈现过多内容造成压力
- **一致性**: 延续现有设计系统的视觉语言和交互模式

### 1.3 设计原则
1. **清晰直观**: 使用清晰的视觉层级和明确的文案
2. **操作高效**: 最小化用户达成目标所需的步骤数
3. **容错性**: 提供撤销机制和二次确认,防止误操作
4. **可访问性**: 支持键盘操作和屏幕阅读器

---

## 2. 组件设计规范

### 2.1 任务编辑弹窗 (Lightbox) 优化

#### 2.1.1 整体布局

**尺寸规范:**
- 宽度: 640px (桌面端)
- 最大高度: 80vh
- 圆角: 12px
- 阴影: `0px 10px 15px -3px rgba(0, 0, 0, 0.1), 0px 4px 6px -2px rgba(0, 0, 0, 0.05)`
- 背景: `#FFFFFF`

**布局结构:**
```
┌─────────────────────────────────────┐
│  弹窗标题栏                         │ 60px高
├─────────────────────────────────────┤
│  提示信息区域 (条件显示)            │ 48px高
├─────────────────────────────────────┤
│                                     │
│  内容区域                           │ 动态高度
│  - 基础信息区                       │
│  - 自定义字段区                     │
│                                     │
├─────────────────────────────────────┤
│  底部操作栏                         │ 72px高
└─────────────────────────────────────┘
```

#### 2.1.2 弹窗标题栏

**元素构成:**
- 标题文字: "编辑任务" (字号16px, 字重600, 颜色#1F2937)
- 关闭按钮: 右上角 "×" 图标 (24×24px, 颜色#6B7280, 悬停变为#1F2937)

**样式规范:**
- 高度: 60px
- 背景: `#FFFFFF`
- 底部边框: 1px solid #E5E7EB
- 内边距: 0 24px

#### 2.1.3 提示信息区域 (Toast)

**成功提示:**
- 背景色: `#ECFDF5` (绿色背景)
- 边框: 1px solid #22C55E
- 图标: ✓ (绿色 #22C55E)
- 文字: "保存成功" (字号14px, 颜色#065F46)
- 高度: 48px
- 内边距: 12px 24px
- 显示时长: 2秒后自动消失

**错误提示:**
- 背景色: `#FEF2F2` (红色背景)
- 边框: 1px solid #EF4444
- 图标: ✗ (红色 #EF4444)
- 文字: 具体错误信息 (字号14px, 颜色#991B1B)
- 高度: 48px
- 内边距: 12px 24px
- 显示时长: 需用户手动关闭或修正错误

#### 2.1.4 基础信息区

**任务描述字段:**
- 标签: "任务描述" (字号13px, 字重500, 颜色#374151)
- 输入框: `<textarea>` (最小高度70px, 最大高度150px, 自动扩展)
- 边框: 1px solid #D1D5DB
- 聚焦边框: 2px solid #4A90E2
- 圆角: 8px
- 内边距: 12px
- 底部间距: 20px

**时间和工期字段:**
采用双栏布局,左右各50%

| 左侧: 开始时间 | 右侧: 工期(天) |
|:---:|:---:|
| 日期选择器 | 数值输入框 |

- 列间距: 16px
- 底部间距: 24px

#### 2.1.5 自定义字段区域 (核心优化)

**区域头部:**
- 标题: "自定义字段" (字号14px, 字重600, 颜色#1F2937)
- 右侧按钮: "管理字段" (文字按钮, 主色#4A90E2)
- 间距: 标题与字段内容之间16px

**布局逻辑:**

字段数量 ≤ 3个:
- 采用单栏布局
- 每个字段占据100%宽度
- 字段间距: 16px

字段数量 4-6个:
- 采用双栏布局 (50% / 50%)
- 列间距: 16px
- 行间距: 16px

字段数量 > 6个:
- 采用双栏布局
- 容器最大高度: 40vh
- 启用垂直滚动
- 滚动条样式: 8px宽, #E5E7EB轨道, #D1D5DB滑块

**字段样式:**
- 标签: 字号13px, 字重500, 颜色#374151, 底部间距5px
- 输入框/选择框:
  - 高度: 40px
  - 边框: 1px solid #D1D5DB
  - 圆角: 8px
  - 内边距: 0 12px
  - 聚焦边框: 2px solid #4A90E2

**必填字段标识:**
- 标签后添加红色星号 "*"
- 未填写时边框变为红色 #EF4444
- 下方显示错误提示文字 "此字段为必填项" (字号12px, 颜色#EF4444)

**多选下拉框优化:**
- 选中项以标签形式展示在输入框内
- 标签样式:
  - 背景: #E0F2FE
  - 文字: #0C4A6E
  - 圆角: 4px
  - 内边距: 2px 8px
  - 右侧 "×" 删除图标

#### 2.1.6 底部操作栏

**布局:**
- 高度: 72px
- 背景: #F9FAFB
- 顶部边框: 1px solid #E5E7EB
- 内边距: 16px 24px
- 按钮右对齐

**按钮规范:**

主按钮 ("保存"):
- 背景: #4A90E2
- 文字: #FFFFFF
- 字号: 14px, 字重500
- 高度: 40px
- 内边距: 0 24px
- 圆角: 8px
- 悬停: 背景变亮10%, 阴影提升
- 点击: 背景变暗10%

次要按钮 ("取消"):
- 背景: #FFFFFF
- 边框: 1px solid #D1D5DB
- 文字: #374151
- 字号: 14px, 字重500
- 高度: 40px
- 内边距: 0 24px
- 圆角: 8px
- 右侧间距: 12px (与保存按钮的间距)

删除按钮 (可选,左对齐):
- 背景: #FFFFFF
- 边框: 1px solid #EF4444
- 文字: #EF4444
- 字号: 14px, 字重500
- 高度: 40px
- 内边距: 0 20px
- 圆角: 8px

---

### 2.2 内联编辑模式 (新增)

#### 2.2.1 触发方式
- 用户单击表格中可编辑的单元格
- 单元格进入编辑状态,显示对应的输入控件

#### 2.2.2 编辑状态样式

**单元格容器:**
- 背景: #FFFFFF
- 边框: 2px solid #4A90E2 (编辑态特殊边框)
- 圆角: 4px
- 阴影: 0px 0px 0px 4px rgba(74, 144, 226, 0.1) (聚焦外发光)

**文本输入框:**
- 高度: 100% (填充单元格)
- 无边框
- 背景: 透明
- 内边距: 8px
- 字号: 14px
- 聚焦时自动全选文本

**下拉选择框:**
- 高度: 100%
- 无边框
- 背景: 透明
- 自动展开下拉选项

**日期选择器:**
- 点击后弹出日期选择器浮层
- 浮层位置: 紧贴单元格下方
- 浮层样式: 白色背景, 12px圆角, 标准阴影

#### 2.2.3 保存和取消

**保存触发:**
- 失焦 (点击其他区域)
- 按Enter键

**取消触发:**
- 按ESC键
- 恢复原值,退出编辑状态

**保存加载状态:**
- 单元格右上角显示小型loading图标 (16×16px)
- 颜色: #4A90E2
- 动画: 旋转

**保存成功:**
- 单元格边框闪烁绿色 #22C55E (0.3秒)
- 显示更新后的值

**保存失败:**
- 单元格边框闪烁红色 #EF4444 (0.5秒)
- 显示错误提示 (Toast)

---

### 2.3 批量编辑面板 (新增)

#### 2.3.1 触发方式
- 用户按住Ctrl/Cmd键点击多个任务行
- 右键菜单选择 "批量编辑"

#### 2.3.2 面板布局

**位置:** 屏幕右侧滑入
**尺寸:**
- 宽度: 400px
- 高度: 100vh
- 背景: #FFFFFF
- 阴影: -4px 0px 12px rgba(0, 0, 0, 0.1)

**动画:**
- 滑入时间: 0.3s
- 缓动函数: ease-out

**结构:**
```
┌─────────────────────────┐
│  标题栏                 │ 60px
├─────────────────────────┤
│  已选任务提示           │ 48px
├─────────────────────────┤
│                         │
│  字段选择区             │
│  字段值设置区           │
│                         │
│  (滚动区域)             │
├─────────────────────────┤
│  底部按钮区             │ 72px
└─────────────────────────┘
```

#### 2.3.3 内容设计

**标题栏:**
- 标题: "批量编辑" (字号16px, 字重600)
- 关闭按钮: 右上角 "×"
- 背景: #FFFFFF
- 底部边框: 1px solid #E5E7EB

**已选任务提示:**
- 背景: #E0F2FE
- 文字: "已选中 X 个任务" (字号14px, 颜色#0C4A6E)
- 图标: ℹ️
- 内边距: 12px 20px

**字段选择下拉框:**
- 标签: "选择要修改的字段"
- 下拉框宽度: 100%
- 选项: 列出所有公共自定义字段

**字段值设置区:**
- 根据选中的字段类型动态显示对应的输入控件
- 样式与编辑弹窗的字段样式一致

**底部按钮区:**
- 背景: #F9FAFB
- 顶部边框: 1px solid #E5E7EB
- 两个按钮: "取消" (次要按钮) 和 "应用到所有任务" (主按钮)

---

### 2.4 字段管理面板 (优化)

#### 2.4.1 触发方式
- 在编辑弹窗的自定义字段区域顶部点击 "管理字段" 按钮

#### 2.4.2 面板布局

**位置:** 编辑弹窗右侧滑入 (不关闭弹窗)
**尺寸:**
- 宽度: 320px
- 高度: 与弹窗内容区相同
- 背景: #F9FAFB
- 左侧边框: 1px solid #E5E7EB

**动画:**
- 滑入时间: 0.25s
- 编辑弹窗宽度同时扩展 (640px → 960px)

#### 2.4.3 内容设计

**标题:**
- "字段管理" (字号14px, 字重600, 颜色#1F2937)
- 右侧关闭按钮 "×"
- 底部间距: 16px

**字段列表:**
- 每个字段项高度: 64px
- 背景: #FFFFFF
- 圆角: 8px
- 内边距: 12px
- 底部间距: 8px
- 悬停: 阴影提升

**字段项内容:**
- 左侧拖拽手柄: "⋮⋮" (颜色#9CA3AF)
- 字段名称 (字号14px, 字重500, 颜色#1F2937)
- 字段类型标签 (字号12px, 背景#E5E7EB, 圆角4px)
- 右侧操作图标: 编辑✏️ 和 删除🗑️

**新增字段按钮:**
- 位于列表底部
- 样式: 次要按钮
- 文字: "+ 新增字段"
- 宽度: 100%

---

## 3. 交互设计规范

### 3.1 编辑弹窗交互流程

**打开弹窗:**
1. 用户双击任务条或任务行
2. 弹窗以 fade + scale 动画弹出 (0.3s)
3. 初始状态: 标题聚焦,所有字段显示当前值

**修改内容:**
1. 用户编辑字段内容
2. 必填字段实时验证 (失焦时)
3. 错误字段显示红色边框和提示文字

**保存:**
1. 用户点击 "保存" 按钮
2. 验证所有字段
3. 验证失败 → 显示错误提示,滚动到第一个错误字段
4. 验证通过 → 保存数据 → 显示成功Toast (2秒) → 弹窗淡出关闭 → 主视图刷新

**取消:**
1. 用户点击 "取消" 或关闭按钮
2. 弹窗淡出关闭
3. 不保存任何修改

### 3.2 内联编辑交互流程

**进入编辑:**
1. 用户单击可编辑单元格
2. 单元格边框变蓝,显示编辑控件
3. 自动聚焦,文本输入框自动全选

**保存:**
1. 用户修改内容后失焦或按Enter
2. 显示loading图标
3. 保存成功 → 边框闪烁绿色 → 显示新值
4. 保存失败 → 边框闪烁红色 → 显示错误Toast

**取消:**
1. 用户按ESC键
2. 恢复原值,退出编辑状态

### 3.3 批量编辑交互流程

**选择任务:**
1. 用户按住Ctrl/Cmd键点击多个任务行
2. 选中的行背景色变为 #E0F2FE
3. 右上角显示 "已选中 X 个任务" 提示

**打开批量编辑:**
1. 用户右键点击选中的任务
2. 菜单显示 "批量编辑" 选项
3. 点击后面板从右侧滑入

**应用修改:**
1. 用户选择字段并设置新值
2. 点击 "应用到所有任务"
3. 显示loading状态
4. 完成后显示 "已成功修改 X 个任务" Toast
5. 面板自动关闭,主视图刷新

---

## 4. 动效规范

### 4.1 弹窗动画

**打开动画:**
- 透明度: 0 → 1 (0.3s)
- 缩放: 0.95 → 1 (0.3s)
- 缓动函数: ease-out

**关闭动画:**
- 透明度: 1 → 0 (0.25s)
- 缩放: 1 → 0.95 (0.25s)
- 缓动函数: ease-in

### 4.2 面板滑入动画

**滑入:**
- 位移: translateX(100%) → translateX(0) (0.3s)
- 缓动函数: ease-out

**滑出:**
- 位移: translateX(0) → translateX(100%) (0.25s)
- 缓动函数: ease-in

### 4.3 Toast提示动画

**显示:**
- 位移: translateY(-10px) → translateY(0) (0.2s)
- 透明度: 0 → 1 (0.2s)

**消失:**
- 透明度: 1 → 0 (0.3s)

### 4.4 字段验证反馈

**错误提示:**
- 边框颜色过渡: #D1D5DB → #EF4444 (0.2s)
- 错误文字淡入: opacity 0 → 1 (0.2s)

**成功闪烁:**
- 边框颜色: #4A90E2 → #22C55E → #D1D5DB
- 每段0.15s,总计0.3s

---

## 5. 响应式适配

### 5.1 编辑弹窗适配

**桌面端 (≥1280px):**
- 弹窗宽度: 640px
- 字段管理面板打开时: 弹窗宽度扩展至 960px

**小屏幕 (<1280px):**
- 弹窗宽度: 90vw
- 字段管理面板以全屏抽屉形式打开 (覆盖弹窗)
- 自定义字段始终单栏布局

**移动端 (<768px):**
- 编辑弹窗全屏显示
- 顶部增加返回按钮
- 按钮栏改为底部固定

### 5.2 批量编辑面板适配

**桌面端 (≥1024px):**
- 面板宽度: 400px

**平板端 (768-1023px):**
- 面板宽度: 350px

**移动端 (<768px):**
- 面板全屏显示
- 顶部增加标题栏和返回按钮

---

## 6. 开发实现建议

### 6.1 技术栈
- 基于现有的DHTMLX Gantt库
- 使用原生JavaScript + CSS实现
- 采用CSS变量管理主题色彩

### 6.2 关键实现点

**动态高度计算:**
```javascript
// 自定义字段区域高度计算逻辑
const fieldCount = customFields.length;
let fieldAreaHeight;

if (fieldCount <= 3) {
    // 单栏布局, 每个字段约70px
    fieldAreaHeight = fieldCount * 70 + 40; // 额外40px用于标题和间距
} else if (fieldCount <= 6) {
    // 双栏布局
    const rows = Math.ceil(fieldCount / 2);
    fieldAreaHeight = rows * 86 + 40; // 每行86px (字段70px + 间距16px)
} else {
    // 超过6个字段,启用滚动
    fieldAreaHeight = Math.min(window.innerHeight * 0.4, 400); // 最大400px或40vh
}
```

**字段验证:**
```javascript
// 实时验证示例
function validateField(field, value) {
    if (field.required && !value) {
        return { valid: false, message: '此字段为必填项' };
    }
    if (field.type === 'number' && isNaN(value)) {
        return { valid: false, message: '请输入有效的数字' };
    }
    return { valid: true };
}
```

**内联编辑实现:**
```javascript
// 单元格点击事件
cell.addEventListener('click', function() {
    const fieldType = cell.dataset.fieldType;
    const currentValue = cell.textContent;

    // 创建对应的编辑器
    const editor = createEditor(fieldType, currentValue);

    // 替换单元格内容
    cell.innerHTML = '';
    cell.appendChild(editor);
    editor.focus();

    // 绑定保存和取消事件
    editor.addEventListener('blur', saveEdit);
    editor.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') saveEdit();
        if (e.key === 'Escape') cancelEdit();
    });
});
```

### 6.3 性能优化建议
- 批量编辑操作使用防抖,避免频繁触发
- 大量字段时使用虚拟滚动
- Toast提示使用对象池,避免频繁创建销毁DOM

### 6.4 可访问性实现
- 所有输入框添加 `aria-label` 属性
- 错误提示使用 `aria-live="polite"` 区域
- 弹窗打开时焦点陷阱 (Tab键循环在弹窗内)
- 支持ESC键关闭弹窗

---

## 7. 设计交付物清单

### 7.1 必须交付
- [x] 本设计规范文档
- [ ] 任务编辑弹窗设计稿 (Figma/Sketch)
- [ ] 内联编辑状态示意图
- [ ] 批量编辑面板设计稿
- [ ] 字段管理面板设计稿
- [ ] 各类Toast提示设计稿

### 7.2 可选交付
- [ ] 交互原型 (可点击的Figma原型)
- [ ] 动效规范演示视频
- [ ] 组件库 (可复用的设计组件)

---

## 8. 后续迭代规划

### 8.1 P2功能设计预留
- **任务模板**: 在弹窗底部预留 "应用模板" 下拉框位置
- **编辑历史**: 在弹窗标题栏右侧预留历史图标位置
- **字段联动**: 在字段管理面板中预留 "联动规则" 配置入口

### 8.2 暗黑模式支持
所有颜色值都使用CSS变量定义,便于未来实现暗黑模式切换:

```css
:root {
    --modal-bg: #FFFFFF;
    --text-primary: #1F2937;
    --border-color: #E5E7EB;
    ...
}

[data-theme="dark"] {
    --modal-bg: #1F2937;
    --text-primary: #F9FAFB;
    --border-color: #374151;
    ...
}
```

---

## 9. 设计验收标准

### 9.1 视觉验收
- [ ] 所有颜色符合设计规范,误差≤5%
- [ ] 所有间距符合8px倍数原则
- [ ] 所有圆角值正确 (8px/12px)
- [ ] 所有字号和字重正确

### 9.2 交互验收
- [ ] 弹窗打开/关闭动画流畅 (60fps)
- [ ] 内联编辑响应时间 < 100ms
- [ ] 字段验证实时反馈 (失焦时)
- [ ] 批量编辑成功率 100%

### 9.3 体验验收
- [ ] 用户无需滚动即可看到≤6个字段
- [ ] 所有操作都有明确的成功/失败反馈
- [ ] 支持键盘操作 (Tab, Enter, ESC)
- [ ] 错误提示文案清晰易懂

---

**文档审核**: 待产品经理审核
**开发对接**: 待前端工程师对接
**预计实现时间**: 根据开发排期确定
