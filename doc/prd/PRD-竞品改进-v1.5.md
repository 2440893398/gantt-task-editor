# 需求文档 (Product Requirements Document) - V1.5 进阶版本

## 1. 概述
- **名称**：甘特图编辑器进阶计划 (Gantt Editor Evolution v1.5)
- **定位**：在 v1.0 建立核心调度能力与稳定性的基础上，引入**专业级决策辅助**与**沉浸式体验**功能。
- **目标用户**：高级项目经理 (需要基线和高级报表)、夜间工作者 (开发者/设计师)。
- **核心价值**：从 "可用" 升级为 "专业" 与 "愉悦"。

## 2. 功能规划分析 (PM & FE 联合评估)

以下功能因技术复杂度高、依赖外部库或非 MVP 必须，从 v1.0 中剥离进入 v1.5：

| 功能特性 | 延迟原因 (V1.0 决策) | V1.5 实施价值 (PM 视角) | 技术路径 (FE 视角) |
| :--- | :--- | :--- | :--- |
| **项目基线 (Baselines)** | UI 渲染复杂，DHTMLX Standard 版无原生 API。 | 核心专业功能。对比 "计划 vs 实际" 偏差是 PM 的刚需。 | 需利用 `addTaskLayer` 或 Canvas 覆盖层手动绘制灰色基线条。 |
| **暗黑模式 (Dark Mode)** | 需要全面重写 CSS 变量与图表皮肤，工期较长。 | 现代化 SaaS 标配，提升开发者好感度。 | 需重构 `variables.css`，并使用 DHTMLX 的 Skin Builder 或覆盖 200+ CSS 类。 |
| **高级导出 (PDF/PNG)** | 涉及 Canvas 截图或后端生成，长图切割是技术难点。 | 汇报工作必需，Excel 无法还原视觉时间线。 | 引入 `html2canvas` 或 DHTMLX 官方 Export 服务 (需评估水印/限制)。 |
| **完整依赖类型 (FF/SF)** | 使用频率低 (SS 仅占 10%, FF/SF < 1%)。 | 完善逻辑闭环，满足极少数严苛场景。 | 扩展调度递归算法，增加 FF (Finish-to-Finish) 和 SF (Start-to-Finish) 逻辑分支。 |
| **资源管理 (Resources)** | 数据结构质变 (Task -> Resource mapping)。 | 避免资源冲突 (Resource Overallocation)。 | 需新增 Resource Store，渲染资源直方图 (Histogram) 或负载图。 |

## 3. 详细需求清单

### 3.1 项目基线 (Project Baselines) - P1
- **目标**：直观展示项目延期情况。
- **功能要求**：
    1.  **创建基线**: 点击 "保存基线" 按钮，当前所有任务的 Start/End/Duration 被快照存入 `baselines` 字段。
    2.  **可视化**: 开启 "显示基线" 开关后，在每个任务条下方渲染一条细灰条 (原始计划)，上方为当前实际进度条。
    3.  **偏差提示**: 鼠标悬停显示 "延期 X 天" 或 "提前 X 天"。

### 3.2 沉浸式暗黑模式 (Dark Mode) - P1
- **目标**：提供符合现代开发者审美的主题。
- **功能要求**：
    1.  **主题切换**: 工具栏增加 ☀️/🌙 切换按钮。
    2.  **配色系统**:
        -   背景：深灰 (`#1E1E1E`)
        -   网格线：低透明度白 (`rgba(255,255,255,0.05)`)
        -   文字：高对比度白/灰
    3.  **组件适配**: 确保所有弹窗、Dropdown、Toast 均适配深色皮肤，无 "白边" 漏光。

### 3.3 高级导出 (Advanced Export) - P2
- **目标**：生成高清、无需拼接的项目汇报图。
- **功能要求**：
    1.  **导出 PDF**: 支持 A4/A3 分页导出，或单页长图导出。
    2.  **导出 PNG**: 将当前甘特图视口（或全图）保存为图片。
    3.  **样式保持**: 导出文件中应保留颜色、连线和基线样式。

### 3.4 资源管理 (Resource Management v0.5) - P2 (探索性)
- **目标**：初步识别资源分配情况。
- **功能要求**：
    1.  **资源分配**: 在任务详情页选择 "负责人" (Resource)。
    2.  **资源列**: Grid 区域显示负责人头像或姓名。
    3.  **简单冲突检测**: 如果同一负责人在同一天有 >2 个任务，标记高亮这一天 (不阻止排程，仅提示)。

### 3.5 智能吸附 (Smart Snapping) - P2
- **目标**：提升拖拽排程的手感。
- **功能要求**：
    1.  **网格吸附**: 拖拽任务条时，自动吸附到最近的 "刻度线" (如: 00:00 或 12:00)。
    2.  **依赖吸附**: 拖拽连线时，自动吸附到目标任务的连接点，增加判定范围。

## 4. 技术挑战与预研
1.  **Baselines 渲染**: DHTMLX Standard 版不支持多层任务条，需使用 `gantt.addTaskLayer` API 注入自定义 DOM，可能影响滚动性能。
2.  **Dark Mode**: DHTMLX 的内部样式大量使用硬编码颜色或背景图，覆盖难度大。建议预研 `skin_builder` 或寻找社区开源主题包。

## 5. 验收标准
1.  **基线**: 保存后修改任务日期，刷新页面基线依然存在且位置正确。
2.  **主题**: 切换暗黑模式无闪烁，无残留白色背景块。
3.  **性能**: 开启基线显示后，FPS 降幅不超过 15%。
