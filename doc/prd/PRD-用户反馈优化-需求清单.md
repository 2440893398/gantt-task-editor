# 用户反馈需求清单

> **来源文档**: [doc/root/1.md](file:///c:/Users/24408/Desktop/新建文件夹/doc/root/1.md)
> **分析日期**: 2026-01-17
> **分析角色**: 产品经理 + 前端开发工程师

---

## 📋 需求汇总表

| ID | 类型 | 需求描述 | 优先级 | 技术复杂度 | 涉及模块 |
|:---|:---:|:---|:---:|:---:|:---|
| OPT-001 | 优化 | 移除表格悬浮查看详情功能 | P1 | 低 | Gantt初始化、样式 |
| OPT-002 | 优化 | 支持直接在表格中编辑值 | P1 | 中 | Gantt表格、编辑器 |
| OPT-003 | 优化 | 本地缓存自定义字段配置和排序 | P0 | 中 | 自定义字段、localStorage |
| OPT-004 | 优化 | 更换导入导出图标使其更直观 | P2 | 低 | 工具栏、图标资源 |
| BUG-001 | Bug | 优先级/状态下拉值未本地化 | P0 | 中 | 国际化、下拉组件 |
| BUG-002 | Bug | Excel导出模板缺少下拉选项 | P1 | 高 | Excel导出、数据验证 |

---

## 🎯 需求详情

### OPT-001: 移除表格悬浮查看详情功能

**需求描述**：用户反馈表格中不需要悬浮查看详情功能，需要移除。

**产品分析**：
- 当前悬浮提示可能干扰用户操作
- 用户希望界面更简洁
- 任务信息已在表格列中展示

**技术分析**：
- 涉及文件：`src/features/gantt/init.js` (tooltip配置)
- 涉及样式：`src/styles/pages/gantt.css` (tooltip样式)
- 实现方式：禁用 `gantt.config.tooltip` 或移除相关模板

**验收标准**：
- [ ] 鼠标悬浮在任务上不再显示详情弹窗
- [ ] 移除相关CSS样式代码

---

### OPT-002: 支持直接在表格中编辑值

**需求描述**：允许用户直接在表格单元格中调整任务属性值，无需打开弹窗编辑。

**产品分析**：
- 提升编辑效率，减少点击次数
- 适合批量快速调整
- 类似Excel的编辑体验

**技术分析**：
- DHTMLX Gantt支持内联编辑 (`gantt.config.inline_editors`)
- 需要配置每个列的编辑器类型
- 可能需要自定义下拉编辑器

**验收标准**：
- [ ] 可以直接在表格中编辑任务名称
- [ ] 可以直接在表格中修改日期
- [ ] 可以直接在表格中选择优先级/状态
- [ ] 编辑后数据自动保存

---

### OPT-003: 本地缓存配置和数据

**需求描述**：本地缓存自定义字段配置、字段排序配置以及任务数据，避免每次刷新页面需要重新配置或导入数据。

**产品分析**：
- 这是纯前端项目，无后端数据库
- 用户每次进入需要重新导入数据非常不便
- 配置持久化是基本用户体验

**技术分析**：
- 当前已使用 localStorage 存储表格宽度
- 需要扩展缓存：
  1. 自定义字段定义 (`customFieldsConfig`)
  2. 字段排序配置 (`columnsOrder`)
  3. 任务数据 (`ganttData`)
- 考虑数据量大时使用 IndexedDB
> [!IMPORTANT]
> 采用 **localStorage + IndexedDB + Dexie.js** 混合存储方案

**存储容量对比**：
| 存储方案 | 容量限制 | 可存储任务数 (每任务约2KB) |
|:---|:---|:---|
| localStorage | 5-10 MB | ~2,500 - 5,000 条 |
| IndexedDB | 100MB - 数GB | ~50,000 - 500,000+ 条 |

**分层存储策略**：
```
┌────────────────────────────────────────────────────┐
│               混合存储策略                           │
├────────────────────────────────────────────────────┤
│                                                    │
│   localStorage (同步、即时加载)                     │
│   ├── 语言设置 (currentLocale)                     │
│   ├── 主题设置 (theme)                             │
│   ├── 列配置 (columnsConfig)                       │
│   └── 自定义字段定义 (customFieldsDef)              │
│                                                    │
│   IndexedDB + Dexie.js (异步、大容量)               │
│   ├── 任务数据 (tasks)                             │
│   ├── 依赖关系 (links)                             │
│   └── 操作历史 (history) - 可选                    │
│                                                    │
└────────────────────────────────────────────────────┘
```

**技术选型理由**：
1. **localStorage** - 配置类小数据，页面加载前即可读取
2. **IndexedDB** - 任务数据量大，支持异步不阻塞UI
3. **Dexie.js** - 简化 IndexedDB API，类似 SQL 的查询语法

**新增依赖**：
- `dexie`: ~40KB (gzip ~15KB)

**代码示例**：
```javascript
// 使用 Dexie.js 管理 IndexedDB
import Dexie from 'dexie';

const db = new Dexie('GanttDB');
db.version(1).stores({
  tasks: '++id, priority, status, start_date',
  links: '++id, source, target'
});

// 保存任务
await db.tasks.bulkPut(tasksArray);

// 查询高优先级任务
const highPriorityTasks = await db.tasks
  .where('priority').equals('high')
  .toArray();
```

**注意事项**：
- Safari/iOS 有更严格的存储限制 (~1GB)
- 隐私/无痕模式下 IndexedDB 可能不可用，需降级处理
- 添加存储配额监控，超过阈值时提示用户

**验收标准**：
- [ ] 刷新页面后自定义字段配置保留
- [ ] 刷新页面后列排序保留
- [ ] 刷新页面后任务数据保留 (支持10,000+任务)
- [ ] 提供清除缓存选项
- [ ] 存储异常时有友好提示

---

### OPT-004: 优化导入导出图标

**需求描述**：更换Excel和JSON导入导出图标，使其更直观和美观。

**产品分析**：
- 当前图标可能不够直观
- 需要区分Excel和JSON格式
- 需要区分导入和导出操作

**技术分析**：
- 使用Heroicons或其他图标库
- 推荐图标方案：
  - Excel导入: 📥 + Excel图标
  - Excel导出: 📤 + Excel图标
  - JSON导入: 📥 + JSON/代码图标
  - JSON导出: 📤 + JSON/代码图标

**验收标准**：
- [ ] Excel和JSON图标可明显区分
- [ ] 导入和导出图标有明显区别
- [ ] 图标风格统一美观

---

### BUG-001: 优先级和状态下拉值未本地化

**需求描述**：切换语言后，优先级和状态的下拉选项没有变化，仍显示原语言。

**产品分析**：
- 国际化不完整，影响多语言用户
- 下拉值应随语言切换动态更新

**技术分析**：
- 当前locales目录包含4种语言文件
- 需要检查下拉组件是否使用i18n
- 可能需要在语言切换时刷新下拉选项

**验收标准**：
- [ ] 切换到英文后优先级显示 High/Medium/Low
- [ ] 切换到日文后优先级显示对应日文
- [ ] 切换到韩文后优先级显示对应韩文
- [ ] 状态字段同样正确本地化

---

### BUG-002: Excel导出模板缺少下拉选项

**需求描述**：Excel导出模板中，优先级、状态以及单选/多选类型的自定义字段没有附带下拉选项，用户填写时无法选择。数值类型也没有限制只能输入数字。

**产品分析**：
- 当前导出模板仅有列标题
- 用户需要手动输入值，容易出错
- 应提供数据验证和下拉选择

**技术分析**：
- 需要使用Excel数据验证功能
- 在指定列添加下拉列表数据验证
- 数值列添加数字格式验证
- 可能需要更新Excel导出库的配置

**验收标准**：
- [ ] 优先级列有下拉选项
- [ ] 状态列有下拉选项
- [ ] 单选/多选自定义字段有下拉选项
- [ ] 数值类型列限制只能输入数字
- [ ] 下拉选项随当前语言本地化

---

## 📊 优先级排序

### P0 - 必须完成 (关键体验/阻塞性Bug)
1. **BUG-001**: 优先级/状态下拉值未本地化
2. **OPT-003**: 本地缓存配置和数据

### P1 - 重要优化
1. **OPT-001**: 移除表格悬浮查看详情功能
2. **OPT-002**: 支持直接在表格中编辑值
3. **BUG-002**: Excel导出模板缺少下拉选项

### P2 - 体验优化
1. **OPT-004**: 优化导入导出图标

---

## 🔧 技术实现建议

### 模块划分
1. **国际化模块**: BUG-001 (预计1-2小时)
2. **数据持久化模块**: OPT-003 (预计2-3小时)
3. **Gantt配置模块**: OPT-001, OPT-002 (预计1-2小时)
4. **Excel导出模块**: BUG-002 (预计3-4小时)
5. **UI优化模块**: OPT-004 (预计0.5-1小时)

### 依赖关系
```
BUG-001 (国际化) ─┬──▶ BUG-002 (Excel下拉需要本地化选项)
                  │
                  └──▶ OPT-002 (表格编辑器需要本地化)
```

---

## ✅ 下一步行动

1. 确认需求优先级是否符合预期
2. 如有补充或修改，请直接说明
3. 确认后可输入 **/PRD** 生成详细的产品需求文档
