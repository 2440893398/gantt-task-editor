# 设计规范文档 - 任务编辑页面优化（Design Specification Document）

## 1. 设计概述

### 1.1 设计理念
以"降低认知负担，提升操作效率"为核心，通过优化任务编辑弹窗的布局、交互和反馈机制，让用户能够更轻松、更直观地管理任务信息。设计遵循"渐进式呈现"原则，将最重要的信息优先展示，减少滚动和多步操作。

### 1.2 目标用户
- 项目管理员：需要频繁配置和管理自定义字段
- 项目经理：需要快速编辑任务属性和跟踪进度
- 团队成员：需要更新任务状态和负责人信息

### 1.3 设计原则
1. **清晰优先**：信息层级分明，避免视觉噪音
2. **效率至上**：减少操作步骤，提供快捷入口
3. **即时反馈**：每个操作都有明确的视觉反馈
4. **灵活自适应**：根据内容动态调整布局

### 1.4 设计方向
- **整体风格**：简约现代，延续现有DESIGN_SPEC.md的科技蓝色系
- **核心原则**：信息降噪、渐进式呈现、即时反馈
- **体验重点**：减少滚动操作、提升字段管理的可发现性、增强操作确定性
- **设计优先级**：动态布局 > 操作反馈 > 字段管理入口 > 批量编辑

---

## 2. 视觉设计规范

### 2.1 色彩系统（延续现有规范）
- **主色调**：`#4A90E2` (科技蓝) - 用于主要按钮、聚焦状态
- **辅助色彩**：`#50E3C2` (薄荷绿) - 用于成功状态、进度指示
- **功能色彩**：
  - 成功：`#22C55E` - 保存成功提示、字段验证通过
  - 警告：`#F59E0B` - 必填字段提示
  - 错误：`#EF4444` - 验证失败、删除操作二次确认
- **中性色**：
  - 深灰 `#1F2937` - 标题和主要文字
  - 中灰 `#6B7280` - 次要文字、提示文本
  - 浅灰 `#E5E7EB` - 边框、分割线
  - 背景灰 `#F9FAFB` - 字段管理面板背景
  - 纯白 `#FFFFFF` - 弹窗背景

### 2.2 字体规范（延续现有规范）
- **弹窗标题**：Semibold 600，18px，颜色 `#1F2937`
- **字段标签**：Medium 500，14px，颜色 `#1F2937`
- **输入内容**：Regular 400，14px，行高 22px，颜色 `#1F2937`
- **提示文字**：Regular 400，12px，颜色 `#6B7280`
- **错误提示**：Regular 400，12px，颜色 `#EF4444`
- **按钮文字**：Medium 500，14px

### 2.3 布局系统
- **弹窗宽度**：
  - 桌面端（≥1280px）：600px
  - 小屏幕（<1280px）：90vw
- **弹窗高度**：动态计算，最小 400px，最大 80vh（桌面端）/ 90vh（小屏幕）
- **内边距**：
  - 弹窗内边距：24px（上下左右）
  - 字段间距：16px（垂直间距）
  - 栏间距（双栏布局）：24px（水平间距）
- **圆角规范**：
  - 弹窗：12px
  - 输入框/下拉框：8px
  - 按钮：8px
  - 提示条（Toast）：8px
- **阴影系统**：
  - 弹窗阴影：`0px 20px 25px -5px rgba(0, 0, 0, 0.1), 0px 10px 10px -5px rgba(0, 0, 0, 0.04)`
  - 字段管理面板阴影：`-4px 0px 6px -1px rgba(0, 0, 0, 0.1)`
  - 提示条阴影：`0px 4px 6px -1px rgba(0, 0, 0, 0.1)`

---

## 3. 交互设计规范

### 3.1 弹窗交互
- **打开方式**：
  - 双击任务条：淡入动画（300ms）+ 轻微缩放（从 95% 到 100%）
  - 点击任务行编辑图标：同上
- **关闭方式**：
  - 点击"取消"按钮：淡出动画（200ms）
  - 点击弹窗外部遮罩：淡出动画（200ms）
  - 按 ESC 键：淡出动画（200ms）
  - 保存成功后：显示成功提示 1 秒后自动淡出（300ms）
- **遮罩层**：背景色 `rgba(0, 0, 0, 0.5)`，支持点击关闭

### 3.2 表单交互
- **输入框状态**：
  - 默认：边框 `#E5E7EB`，背景 `#FFFFFF`
  - 聚焦：边框 `#4A90E2`（2px），添加聚焦阴影 `0 0 0 3px rgba(74, 144, 226, 0.1)`
  - 错误：边框 `#EF4444`（2px），下方显示红色错误文字
  - 禁用：边框 `#E5E7EB`，背景 `#F9FAFB`，文字 `#6B7280`
- **下拉选择器**：
  - 默认状态显示占位符（中灰色 `#6B7280`）
  - 展开时下拉列表向下滑出（200ms），最大高度 240px，超出则滚动
  - 选中项背景色 `#F3F4F6`，悬停项背景色 `#E5E7EB`
- **必填字段标识**：字段标签后显示红色星号 `*`

### 3.3 操作反馈
- **按钮状态**：
  - 默认：主色背景 `#4A90E2`，白色文字，无阴影
  - 悬停：背景变亮 10%（`#5FA3EE`），添加标准阴影
  - 点击：背景变暗 10%（`#3D7AC4`），短暂缩放 98%
  - 加载中：显示旋转图标，文字变为"保存中..."，禁用点击
  - 禁用：浅灰背景 `#E5E7EB`，中灰文字 `#6B7280`
- **保存成功提示**：
  - 位置：弹窗顶部，覆盖标题栏
  - 样式：绿色背景 `#22C55E`，白色文字，高度 48px，圆角 12px（顶部）
  - 内容：✓ 图标 + "保存成功"文字
  - 动效：从顶部滑入（300ms），停留 2 秒后自动滑出（300ms）
- **保存失败提示**：
  - 位置：弹窗顶部，覆盖标题栏
  - 样式：红色背景 `#EF4444`，白色文字，高度 48px，包含关闭按钮
  - 内容：✗ 图标 + 错误信息文字 + 关闭图标
  - 动效：从顶部滑入（300ms），需要用户手动关闭或修正错误后消失
- **字段验证反馈**：
  - 验证失败时，输入框边框变红，下方显示错误提示文字（12px，红色）
  - 点击保存时，自动滚动到第一个错误字段位置，并聚焦该字段

### 3.4 动效规范
- **弹窗动画**：
  - 打开：淡入（opacity 0 → 1）+ 缩放（scale 0.95 → 1），300ms，ease-out
  - 关闭：淡出（opacity 1 → 0），200ms，ease-in
- **字段管理面板动画**：
  - 滑入：从右侧滑入（translateX 100% → 0），300ms，ease-out
  - 滑出：向右侧滑出（translateX 0 → 100%），250ms，ease-in
- **提示条动画**：
  - 出现：从顶部滑入（translateY -100% → 0），300ms，ease-out
  - 消失：向顶部滑出（translateY 0 → -100%），300ms，ease-in
- **按钮微交互**：
  - 点击：缩放 98%，100ms，ease-in-out
  - 加载：旋转图标 360 度循环，1s，linear

---

## 4. 组件设计规范

### 4.1 任务编辑弹窗（Lightbox）

#### 4.1.1 整体结构
```
┌─────────────────────────────────────────────────┐
│ 【标题栏】编辑任务                           [×] │ ← 48px 高
├─────────────────────────────────────────────────┤
│ 【提示条区域】(动态显示)                          │ ← 48px 高（显示时）
├─────────────────────────────────────────────────┤
│ 【任务描述区域】                                  │ ← 自适应高度
│  任务描述                                        │
│  [文本输入框 - 多行]                             │
├─────────────────────────────────────────────────┤
│ 【时间设置区域】                                  │ ← 固定高度
│  开始时间          工期                          │
│  [日期选择器]      [数值输入框] 天               │
├─────────────────────────────────────────────────┤
│ 【自定义字段区域】                    [管理字段 ⚙]│ ← 动态高度
│  ┌─────────────┬──────────────┐                │
│  │ 字段1       │ 字段2        │ (双栏布局)      │
│  │ [输入框]    │ [下拉框]     │                │
│  ├─────────────┼──────────────┤                │
│  │ 字段3       │ 字段4        │                │
│  │ [输入框]    │ [输入框]     │                │
│  └─────────────┴──────────────┘                │
├─────────────────────────────────────────────────┤
│ 【操作按钮区域】                                  │ ← 56px 高
│                          [取消]  [保存]          │
└─────────────────────────────────────────────────┘
```

#### 4.1.2 动态高度计算规则
1. **字段数量 ≤ 3 个**：单栏布局，每个字段高度 72px（标签 20px + 输入框 40px + 间距 12px）
2. **字段数量 4-6 个**：双栏布局，每行高度 72px
3. **字段数量 > 6 个**：双栏布局，自定义字段区域最大高度 400px，超出则启用垂直滚动
4. **弹窗最小高度**：400px
5. **弹窗最大高度**：80vh（桌面端）/ 90vh（小屏幕）

#### 4.1.3 字段布局规范
- **单栏布局**：
  - 字段宽度：100%
  - 字段标签：14px，Medium 500，颜色 `#1F2937`，上边距 16px
  - 输入框：高度 40px，宽度 100%，上边距 8px
- **双栏布局**：
  - 每栏宽度：calc((100% - 24px) / 2)
  - 栏间距：24px
  - 字段标签和输入框样式同单栏
- **滚动条样式**：
  - 宽度：8px
  - 轨道背景：`#F9FAFB`
  - 滑块背景：`#D1D5DB`
  - 滑块悬停：`#9CA3AF`
  - 圆角：4px

### 4.2 字段管理面板

#### 4.2.1 入口位置
- 位置：自定义字段区域右上角
- 样式：文字按钮 + 齿轮图标，颜色 `#4A90E2`
- 文案："管理字段 ⚙"
- 悬停：文字和图标颜色变亮 10%

#### 4.2.2 面板结构
```
┌────────────────────────────┐
│ 字段管理              [×] │ ← 48px 高标题栏
├────────────────────────────┤
│ ┌────────────────────────┐ │
│ │ ≡ 优先级      [编辑][删] │ │ ← 字段项（可拖拽）
│ │   下拉选择             │ │
│ ├────────────────────────┤ │
│ │ ≡ 负责人      [编辑][删] │ │
│ │   文本输入             │ │
│ ├────────────────────────┤ │
│ │ ≡ 状态        [编辑][删] │ │
│ │   下拉选择             │ │
│ └────────────────────────┘ │
│                            │
│ [+ 新增字段]               │ ← 底部固定按钮
└────────────────────────────┘
```

#### 4.2.3 面板规范
- **宽度**：320px（固定）
- **高度**：100%（与弹窗高度一致）
- **背景色**：`#FFFFFF`
- **阴影**：`-4px 0px 6px -1px rgba(0, 0, 0, 0.1)`（左侧阴影）
- **字段项高度**：80px
- **拖拽手柄**：≡ 图标，颜色 `#9CA3AF`，悬停时变为 `#6B7280`
- **操作按钮**：
  - 编辑：✎ 图标，颜色 `#4A90E2`
  - 删除：🗑 图标，颜色 `#EF4444`
  - 尺寸：32px × 32px，圆角 4px，悬停时背景色 `#F3F4F6`

### 4.3 提示条组件（Toast）

#### 4.3.1 成功提示
```
┌───────────────────────────────────────┐
│ ✓  保存成功                           │ ← 绿色背景 #22C55E
└───────────────────────────────────────┘
```
- **高度**：48px
- **背景色**：`#22C55E`
- **文字颜色**：`#FFFFFF`
- **图标**：✓ 白色，16px
- **字体**：Medium 500，14px
- **显示时长**：2 秒后自动消失

#### 4.3.2 错误提示
```
┌───────────────────────────────────────┐
│ ✗  保存失败：必填字段未填写      [×] │ ← 红色背景 #EF4444
└───────────────────────────────────────┘
```
- **高度**：48px
- **背景色**：`#EF4444`
- **文字颜色**：`#FFFFFF`
- **图标**：✗ 白色，16px
- **关闭按钮**：× 白色，悬停时背景半透明白色
- **显示时长**：需要用户手动关闭

### 4.4 批量编辑弹窗

#### 4.4.1 弹窗结构
```
┌─────────────────────────────────────────────────┐
│ 批量编辑 (已选中 5 个任务)                   [×] │
├─────────────────────────────────────────────────┤
│ 【提示信息】                                      │
│ ℹ 以下更改将应用到所有选中的任务                  │
├─────────────────────────────────────────────────┤
│ 【可批量编辑的字段】                              │
│  负责人                                          │
│  [下拉选择器]                                    │
│                                                  │
│  状态                                            │
│  [下拉选择器]                                    │
│                                                  │
│  优先级                                          │
│  [下拉选择器]                                    │
├─────────────────────────────────────────────────┤
│                    [取消]  [应用到所有选中任务]   │
└─────────────────────────────────────────────────┘
```

#### 4.4.2 设计规范
- **弹窗宽度**：500px
- **弹窗最大高度**：70vh
- **提示信息样式**：
  - 背景色：`#EFF6FF`（淡蓝色）
  - 图标：ℹ 蓝色 `#4A90E2`
  - 文字：Regular 400，14px，颜色 `#1F2937`
  - 内边距：12px
  - 圆角：8px
- **字段限制**：只显示自定义字段，不显示任务名称和时间字段
- **确认按钮**：主色背景，文案明确显示影响范围

---

## 5. 页面设计详细说明

| 页面名称 | 页面目标 | 布局结构 | 关键元素 | 交互逻辑 | 状态变化 |
|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|
| 任务编辑弹窗（优化版） | 让用户高效编辑任务的所有属性，减少滚动和操作步骤，提供清晰的操作反馈 | 垂直结构：标题栏 → 提示条（动态）→ 任务描述 → 时间设置 → 自定义字段（动态高度）→ 操作按钮。字段数量 > 3 时启用双栏布局。 | 1. 动态高度的自定义字段区域<br>2. "管理字段"快捷入口<br>3. 成功/失败提示条<br>4. 字段验证错误提示<br>5. 保存/取消按钮 | 1. 双击任务条打开弹窗（淡入动画）<br>2. 修改字段内容，必填字段显示红色星号<br>3. 点击"管理字段"滑出字段管理面板<br>4. 点击"保存"触发验证<br>5. 验证通过后显示成功提示，1 秒后关闭弹窗<br>6. 验证失败显示错误提示，滚动到错误字段 | 1. 字段 ≤ 3：单栏布局<br>2. 字段 4-6：双栏布局<br>3. 字段 > 6：双栏 + 滚动<br>4. 保存中：按钮显示加载图标<br>5. 保存成功：绿色提示条 2 秒<br>6. 保存失败：红色提示条需手动关闭 |
| 字段管理面板 | 提供直观的字段管理入口，支持新增、编辑、删除、排序字段，操作立即生效 | 右侧侧边栏：标题栏 + 字段列表（可拖拽排序）+ 底部"新增字段"按钮 | 1. 字段项（包含拖拽手柄、字段名称、类型、操作按钮）<br>2. 新增字段按钮<br>3. 编辑/删除图标按钮 | 1. 点击"管理字段"按钮面板从右侧滑入（300ms）<br>2. 拖拽字段项调整排序<br>3. 点击"编辑"图标修改字段配置<br>4. 点击"删除"图标二次确认后删除<br>5. 关闭面板后编辑弹窗自动刷新 | 1. 拖拽中：字段项半透明 + 阴影<br>2. 悬停操作按钮：背景色变化<br>3. 删除确认：显示警告对话框<br>4. 操作成功：面板自动刷新列表 |
| 批量编辑弹窗 | 让用户能同时编辑多个任务的公共属性，提升批量操作效率 | 垂直结构：标题栏（显示选中数量）→ 提示信息 → 可批量编辑的字段列表 → 操作按钮 | 1. 选中数量提示<br>2. 操作影响范围提示<br>3. 公共字段表单<br>4. "应用到所有选中任务"按钮 | 1. 在甘特图主界面按住 Ctrl/Cmd 多选任务<br>2. 右键选择"批量编辑"<br>3. 弹窗显示公共字段<br>4. 修改字段后点击"应用"<br>5. 显示"已更新 X 个任务"提示<br>6. 弹窗关闭，主界面刷新 | 1. 字段值为空：表示不修改该字段<br>2. 字段有值：将值应用到所有选中任务<br>3. 应用中：按钮显示加载状态<br>4. 应用成功：显示成功提示并关闭 |

---

## 6. 响应式设计

### 6.1 断点设置
- **桌面端**：≥1280px
- **小屏幕**：<1280px

### 6.2 布局适配

#### 6.2.1 桌面端（≥1280px）
- **弹窗宽度**：600px
- **弹窗最大高度**：80vh
- **字段布局**：字段 > 3 时使用双栏布局
- **字段管理面板**：320px 固定宽度

#### 6.2.2 小屏幕（<1280px）
- **弹窗宽度**：90vw
- **弹窗最大高度**：90vh
- **字段布局**：所有字段强制使用单栏布局（避免在小屏上双栏过于拥挤）
- **字段管理面板**：260px 固定宽度
- **按钮样式**：增大按钮高度到 44px，优化触摸体验

### 6.3 组件适配
- **输入框**：小屏幕下高度从 40px 增加到 44px
- **按钮**：小屏幕下高度从 36px 增加到 44px
- **字段间距**：小屏幕下从 16px 减少到 12px，节省垂直空间
- **字体大小**：保持不变，14px 在小屏幕上仍然清晰可读

---

## 7. 开发交付说明

### 7.1 设计资产
- **图标清单**：
  - 成功图标：✓（绿色，16px）
  - 错误图标：✗（红色，16px）
  - 信息图标：ℹ（蓝色，16px）
  - 关闭图标：×（中灰，16px）
  - 齿轮图标：⚙（蓝色，16px）
  - 编辑图标：✎（蓝色，14px）
  - 删除图标：🗑（红色，14px）
  - 拖拽手柄：≡（中灰，16px）
- **图标格式**：SVG，确保在高清屏下清晰显示
- **颜色变量**：使用 CSS 自定义属性，方便未来主题切换

### 7.2 技术建议
1. **动态高度计算**：
   - 使用 JavaScript 动态计算自定义字段区域高度
   - 字段数量变化时重新计算并应用 CSS `max-height` 和 `overflow-y`
   - 建议使用 ResizeObserver 监听内容变化

2. **字段布局**：
   - 使用 CSS Grid 实现双栏布局，代码更简洁
   - 媒体查询在小屏幕下自动切换为单栏：`grid-template-columns: 1fr`

3. **动画性能**：
   - 使用 CSS Transform 和 Opacity 实现动画，避免触发布局重排
   - 弹窗打开：`transform: scale(0.95) → scale(1)` + `opacity: 0 → 1`
   - 面板滑入：`transform: translateX(100%) → translateX(0)`
   - 使用 `will-change` 属性优化动画性能，但仅在动画进行时应用

4. **字段验证**：
   - 建议使用表单验证库（如 Yup 或 Zod）统一管理验证规则
   - 验证失败时，滚动到错误字段：`element.scrollIntoView({ behavior: 'smooth', block: 'center' })`

5. **状态管理**：
   - 字段配置变更后，需要更新 DHTMLX Gantt 的 lightbox 配置
   - 建议在字段管理面板关闭时触发 `gantt.resetLightbox()` 重新渲染

### 7.3 实现注意事项

#### 7.3.1 关键技术点
1. **DHTMLX Gantt Lightbox 自定义**：
   - 使用 `gantt.config.lightbox.sections` 动态配置字段
   - 通过 CSS 覆盖 `.gantt_cal_light` 类的默认样式
   - 自定义验证：在 `gantt.attachEvent("onLightboxSave")` 中实现

2. **字段动态高度实现思路**：
```javascript
// 伪代码示例
function calculateCustomFieldsHeight(fieldCount) {
  const fieldHeight = 72; // 单个字段高度
  const maxHeight = 400; // 最大高度

  let height;
  if (fieldCount <= 3) {
    height = fieldCount * fieldHeight; // 单栏
  } else {
    height = Math.ceil(fieldCount / 2) * fieldHeight; // 双栏
  }

  return Math.min(height, maxHeight); // 不超过最大高度
}
```

3. **字段管理面板实现思路**：
```javascript
// 使用 Sortable.js 实现拖拽排序
import Sortable from 'sortablejs';

const fieldList = document.querySelector('.field-list');
Sortable.create(fieldList, {
  animation: 150,
  handle: '.drag-handle',
  onEnd: (evt) => {
    // 更新字段顺序
    updateFieldOrder(evt.oldIndex, evt.newIndex);
  }
});
```

4. **提示条组件实现思路**：
```javascript
// 显示成功提示
function showSuccessToast(message) {
  const toast = document.createElement('div');
  toast.className = 'toast toast-success';
  toast.innerHTML = `<span class="toast-icon">✓</span>${message}`;

  // 添加到弹窗顶部
  lightboxElement.prepend(toast);

  // 2 秒后自动移除
  setTimeout(() => {
    toast.classList.add('toast-fade-out');
    setTimeout(() => toast.remove(), 300);
  }, 2000);
}
```

#### 7.3.2 浏览器兼容性
- **支持的浏览器**：Chrome 90+、Edge 90+、Firefox 88+、Safari 14+
- **CSS 特性**：
  - CSS Grid（已广泛支持）
  - CSS 自定义属性（已广泛支持）
  - `backdrop-filter`（Safari 需要 -webkit- 前缀）
- **JavaScript 特性**：
  - `ResizeObserver`（已广泛支持）
  - `scrollIntoView({ behavior: 'smooth' })`（已广泛支持）

#### 7.3.3 性能优化建议
1. **减少重排和重绘**：
   - 使用 `transform` 和 `opacity` 实现动画，避免改变 `width`、`height`、`top`、`left`
   - 批量 DOM 操作使用 DocumentFragment

2. **防抖和节流**：
   - 字段输入时的验证使用防抖（debounce，300ms）
   - 窗口 resize 事件使用节流（throttle，200ms）

3. **懒加载**：
   - 字段管理面板仅在点击"管理字段"时才渲染
   - 批量编辑弹窗仅在用户多选任务后才创建

4. **缓存计算结果**：
   - 字段高度计算结果缓存，仅在字段数量变化时重新计算

#### 7.3.4 无障碍访问（A11y）
1. **键盘导航**：
   - 所有按钮和输入框支持 Tab 键导航
   - ESC 键关闭弹窗和面板
   - Enter 键在聚焦"保存"按钮时触发保存

2. **语义化 HTML**：
   - 使用 `<button>` 而非 `<div>` 实现按钮
   - 表单字段使用 `<label>` 标签，`for` 属性关联输入框 `id`

3. **ARIA 属性**：
   - 弹窗添加 `role="dialog"` 和 `aria-modal="true"`
   - 提示条添加 `role="alert"` 和 `aria-live="assertive"`
   - 错误提示添加 `aria-invalid="true"` 到输入框

4. **对比度**：
   - 文字与背景对比度符合 WCAG AA 标准（至少 4.5:1）
   - 错误提示红色 `#EF4444` 与白色背景对比度 4.5:1 以上

---

## 8. 设计检查清单

### 8.1 布局检查
- [ ] 字段 ≤ 3 个时使用单栏布局
- [ ] 字段 4-6 个时使用双栏布局
- [ ] 字段 > 6 个时双栏布局 + 滚动
- [ ] 弹窗最小高度 400px
- [ ] 弹窗最大高度 80vh（桌面端）/ 90vh（小屏幕）
- [ ] 小屏幕（<1280px）强制单栏布局

### 8.2 交互检查
- [ ] 双击任务条打开弹窗，淡入动画 300ms
- [ ] 点击"保存"触发字段验证
- [ ] 验证通过后显示成功提示 2 秒，然后关闭弹窗
- [ ] 验证失败后显示错误提示，滚动到错误字段
- [ ] 点击"管理字段"面板从右侧滑入 300ms
- [ ] 关闭字段管理面板后弹窗自动刷新
- [ ] ESC 键关闭弹窗和面板
- [ ] 点击遮罩层关闭弹窗

### 8.3 反馈检查
- [ ] 成功提示：绿色背景、✓ 图标、2 秒自动消失
- [ ] 错误提示：红色背景、✗ 图标、手动关闭
- [ ] 字段验证错误：红色边框、错误文字
- [ ] 按钮悬停：背景色变化、添加阴影
- [ ] 按钮点击：短暂缩放 98%
- [ ] 保存中：按钮显示加载图标、文字变为"保存中..."

### 8.4 无障碍检查
- [ ] 所有按钮支持 Tab 键导航
- [ ] 表单字段有 `<label>` 标签
- [ ] 弹窗有 `role="dialog"`
- [ ] 提示条有 `role="alert"`
- [ ] 文字对比度符合 WCAG AA 标准

---

## 9. 附录：设计决策说明

### 9.1 为什么采用动态高度而非固定高度？
**问题**：固定 200px 高度导致字段多时需要滚动，用户体验差。

**解决方案**：
1. 根据字段数量动态计算高度
2. 字段 ≤ 3 时完全展开，无需滚动
3. 字段 > 6 时限制最大高度 400px，避免弹窗过高

**预期效果**：80% 的场景下（字段 ≤ 6）用户无需滚动即可看到所有字段。

### 9.2 为什么在弹窗内放置"管理字段"入口？
**问题**：字段管理功能隐藏在右上角工具栏，用户发现率低。

**解决方案**：
1. 在自定义字段区域右上角显示"管理字段"按钮
2. 点击后从右侧滑出字段管理面板（而非新开弹窗）
3. 操作完成后面板关闭，弹窗自动刷新

**预期效果**：用户在编辑任务时能立即发现字段管理功能，使用率提升 50%。

### 9.3 为什么采用双栏布局而非始终单栏？
**问题**：字段数量多时，单栏布局导致弹窗过高，影响体验。

**解决方案**：
1. 字段 > 3 时自动切换为双栏布局
2. 双栏布局节省垂直空间，减少滚动
3. 小屏幕下强制单栏，避免双栏过于拥挤

**预期效果**：在保持可读性的前提下，最大化空间利用率。

### 9.4 为什么保存成功后延迟 1 秒才关闭弹窗？
**问题**：保存后立即关闭弹窗，用户看不到成功提示，缺乏确定性。

**解决方案**：
1. 保存成功后显示绿色提示条
2. 提示条停留 2 秒
3. 提示条显示 1 秒后关闭弹窗（用户能看到至少 1 秒的成功提示）

**预期效果**：用户能明确知道操作成功，心理安全感提升。

---

## 10. 后续设计工作

### 10.1 本次交付内容
1. ✅ 任务编辑弹窗优化设计规范
2. ✅ 字段管理面板设计规范
3. ✅ 批量编辑弹窗设计规范
4. ✅ 操作反馈组件设计规范
5. ✅ 响应式适配方案
6. ✅ 开发实现指导

### 10.2 待产出内容（由前端开发实现）
1. ⏳ 高保真视觉稿（可选，当前规范已足够详细）
2. ⏳ 交互原型（可选，可直接进入开发）
3. ⏳ 代码实现（基于本设计规范）

### 10.3 未来优化方向（P2）
1. 任务编辑历史记录功能的设计
2. 字段级权限控制（只读/可编辑）的交互设计
3. 自定义字段模板功能的设计
4. 字段条件显示（根据其他字段值动态显示/隐藏）的设计

---

**文档版本**：v1.0
**创建日期**：2026-01-05
**设计师**：UI/UX Designer
**状态**：已完成，待开发实现
