# 测试用例文档：分布式前端 AI Agent 架构 (BYOK 模式)

## 1. 测试概述

| 项目 | 说明 |
|:-----|:-----|
| **测试对象** | 分布式前端 AI Agent 架构 (BYOK 模式) |
| **需求来源** | [PRD-AI-Agent-架构.md](file:///c:/Users/24408/Desktop/新建文件夹/doc/prd/PRD-AI-Agent-架构.md) |
| **测试目标** | 验证 AI Agent 核心功能、配置管理、流式交互及安全性等需求的正确实现 |
| **测试范围** | 配置管理(F-001~F-003)、智能体交互(F-004~F-007)、兼容性与路由(F-008~F-009)、非功能需求(NF-001~NF-003) |

---

## 2. 测试环境

| 项目 | 说明 |
|:-----|:-----|
| **浏览器** | Chrome 120+ / Firefox 120+ / Safari 17+ |
| **分辨率** | 1920x1080 (桌面) / 375x667 (移动端) |
| **测试框架** | Vitest (单元测试) / Playwright (E2E测试) |
| **依赖条件** | 本地开发服务器运行、模拟 LLM API 端点可用 |

### 2.1 测试用 AI API 配置

> [!IMPORTANT]
> 以下配置仅用于测试目的,请勿在生产环境使用。

| 配置项 | 值 |
|:-------|:---|
| **Base URL** | `https://aihubmix.com` |
| **API Key** | `sk-S5X85Jym6IfIehAmD08bF265C95443E69857Da1c5481A890` |
| **推荐模型** | `gemini-3-flash-preview-free` (测试时优先使用,成本较低) |

**使用说明：**
- 需要真实 AI 响应的测试用例(如 TC-STR-001、TC-CMP-001 等)应使用此配置
- 纯 UI 交互测试可使用 Mock Service Worker 模拟响应
- 测试完成后请清除浏览器中的 API Key 配置

---

## 3. 测试用例

### 3.1 配置管理 (Configuration Management)

#### 3.1.1 F-001 API 配置入口

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-CFG-001 | 配置弹窗正常打开 | 应用已加载 | 1. 点击 AI 配置入口按钮<br>2. 观察配置弹窗 | 配置弹窗正确显示，包含 Base URL 和 API Key 输入框 | P0 |
| TC-CFG-002 | Base URL 输入验证 | 配置弹窗已打开 | 1. 输入有效 URL `https://api.openai.com/v1`<br>2. 点击保存 | URL 被接受并保存成功 | P0 |
| TC-CFG-003 | API Key 输入验证 | 配置弹窗已打开 | 1. 输入 API Key `sk-xxxxxxxx`<br>2. 点击保存 | API Key 被接受并保存成功 | P0 |
| TC-CFG-004 | 配置表单空值提交 | 配置弹窗已打开 | 1. 清空所有输入框<br>2. 点击保存 | 显示验证错误提示，不允许空值提交 | P1 |
| TC-CFG-005 | 模型选择下拉框 | 配置弹窗已打开 | 1. 点击模型选择下拉框<br>2. 选择 `gpt-4` | 模型选择正确更新为 gpt-4 | P1 |

#### 3.1.2 F-002 配置持久化

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-CFG-010 | LocalStorage 保存验证 | 配置已输入 | 1. 输入 Base URL 和 API Key<br>2. 点击保存<br>3. 检查 LocalStorage | 配置正确保存到 LocalStorage | P0 |
| TC-CFG-011 | 页面刷新后配置恢复 | 配置已保存 | 1. 刷新页面<br>2. 打开配置弹窗 | 之前保存的配置正确恢复显示 | P0 |
| TC-CFG-012 | 会话存储选项 | 配置弹窗已打开 | 1. 勾选"仅本次会话有效"<br>2. 保存配置<br>3. 关闭浏览器重新打开 | 配置未被保留 | P1 |
| TC-CFG-013 | 清除配置功能 | 配置已保存 | 1. 点击"清除配置"按钮<br>2. 确认清除 | 所有配置被清除，LocalStorage 中无AI配置数据 | P1 |

#### 3.1.3 F-003 本地模型支持

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-CFG-020 | Ollama 本地地址识别 | 配置弹窗已打开 | 1. 输入 `http://localhost:11434/v1`<br>2. 保存配置 | 系统识别为本地模型，显示本地模型提示 | P0 |
| TC-CFG-021 | CORS 提示显示 | 配置为本地模型 | 1. 配置本地模型地址<br>2. 发起请求 | 若遇到 CORS 问题，显示友好的跨域配置提示 | P1 |
| TC-CFG-022 | 本地模型无 Key 场景 | 配置弹窗已打开 | 1. 配置本地模型地址<br>2. API Key 留空<br>3. 保存 | 允许保存，提示"本地模型可无需 API Key" | P1 |

---

### 3.2 智能体交互 (Agent Interaction)

#### 3.2.1 F-004 预设智能体调用

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-AGT-001 | 任务润色助手调用 | API 已配置、任务已选中 | 1. 选中一个任务<br>2. 点击"AI 润色"按钮 | 触发任务润色 Agent，显示加载状态 | P0 |
| TC-AGT-002 | Bug 报告专家调用 | API 已配置 | 1. 点击"生成 Bug 报告"按钮 | 触发 Bug 报告 Agent，显示加载状态 | P0 |
| TC-AGT-003 | 无 API 配置时调用 Agent | API 未配置 | 1. 点击任意 Agent 按钮 | 显示提示"请先配置 API Key"，自动弹出配置弹窗 | P0 |
| TC-AGT-004 | Agent 注册表完整性 | 系统启动 | 1. 检查 Agent 注册表 | 所有预设 Agent 都有完整的 id、name、system、userPrompt | P1 |

#### 3.2.2 F-005 流式响应 (Streaming)

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-STR-001 | 流式打字机效果 | API 已配置 | 1. 触发 Agent 调用<br>2. 观察响应区域 | 文字以打字机效果逐字/逐段显示 | P0 |
| TC-STR-002 | 流式响应中断恢复 | 流式响应进行中 | 1. 网络中断 3 秒<br>2. 网络恢复 | 显示错误提示，允许用户重试 | P1 |
| TC-STR-003 | 长文本流式显示 | API 已配置 | 1. 触发生成长文本的 Agent<br>2. 观察滚动行为 | 响应区域自动滚动到最新内容 | P1 |
| TC-STR-004 | 流式响应取消 | 流式响应进行中 | 1. 点击"停止生成"按钮 | 流式响应立即停止，显示已生成的部分内容 | P0 |

#### 3.2.3 F-006 状态反馈

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-STS-001 | 加载状态显示 | API 已配置 | 1. 触发 Agent 调用<br>2. 观察状态指示器 | 显示加载动画或"正在生成..."提示 | P0 |
| TC-STS-002 | 生成完成状态 | AI 响应完成 | 1. 等待 Agent 响应完成<br>2. 观察状态变化 | 加载状态消失，显示"生成完成"或响应内容 | P0 |
| TC-STS-003 | API Key 无效错误 | 使用无效 Key | 1. 配置错误的 API Key<br>2. 触发 Agent 调用 | 显示"API Key 无效"错误提示 | P0 |
| TC-STS-004 | 网络错误状态 | 网络不可用 | 1. 断开网络<br>2. 触发 Agent 调用 | 显示"网络错误"提示，提供重试选项 | P0 |
| TC-STS-005 | 模型不存在错误 | 配置不存在的模型 | 1. 配置不存在的模型名称<br>2. 触发 Agent 调用 | 显示"模型不存在"错误提示 | P1 |
| TC-STS-006 | 限流错误处理 | API 限流 | 1. 连续快速发起多次请求 | 显示友好的限流提示和等待建议 | P1 |

#### 3.2.4 F-007 动态上下文注入

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-CTX-001 | 任务文本上下文注入 | 任务已选中 | 1. 选中包含文本的任务<br>2. 触发 Agent<br>3. 检查发送的 prompt | Prompt 中包含选中任务的文本内容 | P0 |
| TC-CTX-002 | 多任务上下文注入 | 多个任务已选中 | 1. 选中多个任务<br>2. 触发 Agent | Prompt 中包含所有选中任务的信息 | P1 |
| TC-CTX-003 | 环境信息注入 | 应用运行中 | 1. 触发需要环境信息的 Agent<br>2. 检查 prompt | Prompt 中包含当前日期、语言等环境信息 | P1 |
| TC-CTX-004 | 空上下文处理 | 无任务选中 | 1. 不选中任何任务<br>2. 触发 Agent | 显示提示"请先选中任务"或使用默认上下文 | P1 |

---

### 3.3 兼容性与路由 (Compatibility & Routing)

#### 3.3.1 F-008 OpenAI 协议兼容

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-CMP-001 | OpenAI API 兼容性 | 配置 OpenAI endpoint | 1. 配置真实 OpenAI API<br>2. 触发 Agent | 正常获取并展示响应 | P0 |
| TC-CMP-002 | DeepSeek API 兼容性 | 配置 DeepSeek endpoint | 1. 配置 DeepSeek API<br>2. 触发 Agent | 正常获取并展示响应 | P0 |
| TC-CMP-003 | Ollama API 兼容性 | 本地 Ollama 运行 | 1. 配置 Ollama endpoint<br>2. 触发 Agent | 正常获取并展示响应 | P0 |
| TC-CMP-004 | Chat Completion 请求格式 | API 已配置 | 1. 触发 Agent<br>2. 检查请求体 | 请求格式符合 OpenAI Chat Completion 标准 | P1 |

#### 3.3.2 F-009 智能路由

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-RTE-001 | 云端 API 路由识别 | 配置云端 URL | 1. 配置 `https://api.openai.com/v1`<br>2. 检查路由策略 | 系统识别为云端 API，启用代理转发策略 | P1 |
| TC-RTE-002 | 本地 API 直连识别 | 配置本地 URL | 1. 配置 `http://localhost:11434/v1`<br>2. 检查路由策略 | 系统识别为本地 API，启用直连策略 | P1 |
| TC-RTE-003 | 路由策略切换 | 已配置云端 | 1. 更改为本地配置<br>2. 保存 | 路由策略自动切换为直连模式 | P1 |

---

### 3.4 非功能需求

#### 3.4.1 NF-001 安全性

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-SEC-001 | API Key 不明文日志 | API 已配置 | 1. 打开浏览器控制台<br>2. 触发 Agent<br>3. 检查日志输出 | 控制台日志中无明文 API Key | P0 |
| TC-SEC-002 | LocalStorage 加密存储 | 配置已保存 | 1. 检查 LocalStorage 中的 AI 配置 | API Key 以加密形式存储，非明文 | P0 |
| TC-SEC-003 | 网络请求 Key 安全 | API 调用进行中 | 1. 打开网络面板<br>2. 检查请求头 | API Key 仅在 Authorization Header 中传输 | P0 |
| TC-SEC-004 | Key 遮罩显示 | 配置弹窗已打开 | 1. 输入 API Key<br>2. 观察输入框 | Key 以密码形式遮罩显示，非明文 | P1 |

#### 3.4.2 NF-002 响应速度

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-PRF-001 | 请求去抖动验证 | API 已配置 | 1. 快速连续点击 Agent 按钮 5 次<br>2. 检查网络请求 | 仅发送 1 次请求，其余被去抖动拦截 | P0 |
| TC-PRF-002 | 重复请求拦截 | 请求进行中 | 1. 发起 Agent 请求<br>2. 请求完成前再次点击 | 第二次点击被忽略或显示"请求进行中"提示 | P0 |
| TC-PRF-003 | 首次响应时间 | API 已配置 | 1. 触发 Agent<br>2. 测量首字符出现时间 | 首字符在合理时间内出现（依赖网络条件） | P1 |

#### 3.4.3 NF-003 可维护性

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-MNT-001 | Prompt 与 UI 分离 | 代码检查 | 1. 检查代码结构<br>2. 验证 Prompt 定义位置 | Prompt 定义在 `prompts/` 目录，与 UI 代码分离 | P1 |
| TC-MNT-002 | Agent 热更新支持 | 开发模式 | 1. 修改 Agent Prompt<br>2. 保存文件 | Agent 配置热更新，无需刷新页面 | P2 |
| TC-MNT-003 | 新增 Agent 扩展性 | 代码检查 | 1. 按规范新增一个 Agent<br>2. 验证可用性 | 新 Agent 自动注册，无需修改核心代码 | P1 |

---

### 3.5 边界测试

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-B-001 | 超长 API Key 输入 | 配置弹窗已打开 | 1. 输入 1000 字符的 Key<br>2. 保存 | 系统正确处理，保存或提示长度限制 | P1 |
| TC-B-002 | 特殊字符 URL 输入 | 配置弹窗已打开 | 1. 输入包含中文、空格的 URL<br>2. 保存 | 正确处理或提示格式错误 | P1 |
| TC-B-003 | 超长 Prompt 上下文 | 选中大量任务 | 1. 选中 100 个任务<br>2. 触发 Agent | 系统截断或分批处理上下文，不崩溃 | P1 |
| TC-B-004 | 空 Base URL 提交 | 配置弹窗已打开 | 1. API Key 有值，Base URL 为空<br>2. 保存 | 提示"请输入 Base URL" | P1 |
| TC-B-005 | 最小响应处理 | API 返回空响应 | 1. 模拟 API 返回空内容 | 显示"无响应内容"提示，不报错 | P1 |
| TC-B-006 | 超时响应处理 | API 响应延迟 | 1. 模拟 60 秒无响应 | 显示超时提示，提供重试选项 | P1 |

---

### 3.6 异常测试

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-E-001 | 非法 URL 格式 | 配置弹窗已打开 | 1. 输入 `invalid-url`<br>2. 保存 | 提示"URL 格式无效" | P0 |
| TC-E-002 | HTTP(非HTTPS) URL 警告 | 配置弹窗已打开 | 1. 输入 `http://api.example.com`<br>2. 保存 | 显示安全警告提示，允许用户确认后保存 | P1 |
| TC-E-003 | LocalStorage 满存储 | 存储空间已满 | 1. 填满 LocalStorage<br>2. 尝试保存配置 | 显示存储空间不足提示 | P2 |
| TC-E-004 | JSON 解析错误 | API 返回非标准响应 | 1. 模拟 API 返回非 JSON 内容 | 显示"响应格式错误"提示 | P1 |
| TC-E-005 | SSE 流中断 | 流式响应进行中 | 1. 模拟 SSE 连接意外断开 | 显示错误提示，保留已接收内容 | P1 |
| TC-E-006 | 401 未授权错误 | API Key 过期 | 1. 使用过期的 API Key | 显示"认证失败，请检查 API Key"提示 | P0 |
| TC-E-007 | 429 限流错误 | 请求过于频繁 | 1. 超过 API 限流阈值 | 显示限流提示和建议等待时间 | P1 |
| TC-E-008 | 500 服务器错误 | API 服务异常 | 1. 模拟服务端错误 | 显示"服务暂时不可用"提示 | P1 |

---

### 3.7 国际化测试

| 编号 | 名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|:----:|:-----|:---------|:---------|:---------|:------:|
| TC-I-001 | 中文界面完整性 | 语言设置为 zh-CN | 1. 打开 AI 配置弹窗<br>2. 检查所有标签和按钮 | 所有文案正确显示中文 | P1 |
| TC-I-002 | 英文界面完整性 | 语言设置为 en-US | 1. 切换语言为英文<br>2. 打开 AI 配置弹窗 | 所有文案正确显示英文 | P1 |
| TC-I-003 | 日文界面完整性 | 语言设置为 ja-JP | 1. 切换语言为日文<br>2. 打开 AI 配置弹窗 | 所有文案正确显示日文 | P2 |
| TC-I-004 | 韩文界面完整性 | 语言设置为 ko-KR | 1. 切换语言为韩文<br>2. 打开 AI 配置弹窗 | 所有文案正确显示韩文 | P2 |
| TC-I-005 | 错误提示国际化 | 多语言环境 | 1. 在不同语言下触发错误<br>2. 检查错误提示 | 错误提示随语言切换而变化 | P1 |
| TC-I-006 | Agent 名称国际化 | 多语言环境 | 1. 在不同语言下查看 Agent 列表 | Agent 名称和描述正确本地化 | P1 |

---

## 4. 测试数据

### 4.1 正常数据

| 数据类型 | 示例值 | 说明 |
|:---------|:-------|:-----|
| Base URL | `https://api.openai.com/v1` | 标准 OpenAI Endpoint |
| Base URL | `https://api.deepseek.com/v1` | DeepSeek Endpoint |
| Base URL | `http://localhost:11434/v1` | 本地 Ollama Endpoint |
| API Key | `sk-xxxxxxxxxxxxxxxxxxxxxxxx` | 标准格式 Key |
| Model | `gpt-3.5-turbo`, `gpt-4`, `deepseek-chat` | 有效模型名称 |
| 任务文本 | 正常长度的任务描述文本 (100-500字符) | 常规上下文 |

### 4.2 边界数据

| 数据类型 | 示例值 | 说明 |
|:---------|:-------|:-----|
| API Key | 1000 字符的超长字符串 | 超长 Key |
| Base URL | 包含 Unicode 的 URL | 特殊字符 URL |
| 上下文 | 100 个任务的合并文本 | 超大上下文 |
| 响应 | 空字符串 `""` | 最小响应 |
| 响应 | 100KB 文本 | 超大响应 |

### 4.3 异常数据

| 数据类型 | 示例值 | 说明 |
|:---------|:-------|:-----|
| Base URL | `invalid-url`, `ftp://wrong.com` | 无效 URL 格式 |
| API Key | `wrong-key-format` | 无效 Key 格式 |
| Model | `non-existent-model` | 不存在的模型 |
| 响应 | `<html>Error</html>` | 非 JSON 响应 |
| 状态码 | 401, 429, 500, 503 | 错误状态码 |

---

## 5. 测试优先级说明

| 优先级 | 说明 | 用例数量 |
|:------:|:-----|:--------:|
| P0 | 核心功能，阻塞发布 | 22 |
| P1 | 重要功能，影响用户体验 | 34 |
| P2 | 次要功能，不影响核心流程 | 4 |

---

## 6. 测试工具映射

| 测试类型 | 推荐工具 | 说明 |
|:---------|:---------|:-----|
| 单元测试 | Vitest | API 客户端、配置存储、Agent 注册表、上下文注入逻辑 |
| E2E 测试 | Playwright | 配置弹窗交互、流式响应展示、完整用户流程 |
| API 模拟 | MSW (Mock Service Worker) | 模拟 LLM API 响应 |
| 安全测试 | 手动 + DevTools | 检查 Key 泄露、存储加密 |

---

## 7. 附录：测试用例统计

| 类别 | 用例数量 |
|:-----|:--------:|
| 配置管理 (3.1) | 14 |
| 智能体交互 (3.2) | 18 |
| 兼容性与路由 (3.3) | 7 |
| 非功能需求 (3.4) | 11 |
| 边界测试 (3.5) | 6 |
| 异常测试 (3.6) | 8 |
| 国际化测试 (3.7) | 6 |
| **总计** | **70** |
