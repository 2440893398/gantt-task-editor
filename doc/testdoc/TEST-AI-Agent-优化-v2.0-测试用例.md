# 测试用例文档: AI Agent 交互优化 v2.0

**文档版本**: v1.0
**关联 PRD**: [PRD-AI-Agent-优化-v2.0.md](../prd/PRD-AI-Agent-优化-v2.0.md)
**关联设计规范**: [DESIGN_SPEC_AI_Agent_优化_v2.0.md](../design/DESIGN_SPEC_AI_Agent_优化_v2.0.md)
**创建日期**: 2026-01-18
**作者**: 测试工程师
**状态**: 待评审

---

## 目录

1. [测试概述](#1-测试概述)
2. [测试范围](#2-测试范围)
3. [测试用例](#3-测试用例)
   - [3.1 F-101 AI 设置页面样式优化](#31-f-101-ai-设置页面样式优化)
   - [3.2 F-102 模型下拉选择框优化](#32-f-102-模型下拉选择框优化)
   - [3.3 F-103 模型列表刷新功能](#33-f-103-模型列表刷新功能)
   - [3.4 F-104 智能错误提示](#34-f-104-智能错误提示)
   - [3.5 F-105 侧边栏样式优化](#35-f-105-侧边栏样式优化)
   - [3.6 F-106 多轮对话交互](#36-f-106-多轮对话交互)
   - [3.7 F-107 结果 JSON 结构化呈现](#37-f-107-结果-json-结构化呈现)
   - [3.8 F-108 优化结果应用/撤回](#38-f-108-优化结果应用撤回)
   - [3.9 F-109 提示词部分可编辑](#39-f-109-提示词部分可编辑)
   - [3.10 F-110 AI 重新调用](#310-f-110-ai-重新调用)
   - [3.11 F-111 Token 使用统计](#311-f-111-token-使用统计)
   - [3.12 F-112 任务概述字段](#312-f-112-任务概述字段)
4. [测试数据准备](#4-测试数据准备)
5. [测试环境要求](#5-测试环境要求)

---

## 1. 测试概述

### 1.1 测试目的

本测试用例文档旨在验证 AI Agent 交互优化 v2.0 版本的所有功能需求，确保：
- 所有新增功能按需求正确实现
- UI 交互符合设计规范
- 异常情况得到妥善处理
- 各端适配良好

### 1.2 测试策略

| 测试类型 | 覆盖范围 | 执行方式 |
|:--------:|:--------:|:--------:|
| 功能测试 | 正常流程、异常流程、边界情况 | 手动 + 自动化 |
| UI 测试 | 视觉还原、交互反馈、动效 | 手动 |
| 响应式测试 | 桌面端、平板端、移动端 | 手动 |
| 兼容性测试 | Chrome、Firefox、Safari、Edge | 手动 + 自动化 |
| 性能测试 | 响应时间、流式输出 | 自动化 |
| 可访问性测试 | 键盘操作、屏幕阅读器 | 手动 |

### 1.3 优先级说明

| 优先级 | 说明 | 执行顺序 |
|:------:|:----:|:--------:|
| P0 | 核心功能，必须通过 | 优先执行 |
| P1 | 重要功能 | 次优先执行 |
| P2 | 增强功能 | 按需执行 |

---

## 2. 测试范围

### 2.1 功能需求覆盖

| 需求编号 | 需求名称 | PRD 优先级 | 测试用例数量 |
|:--------:|:--------:|:----------:|:------------:|
| F-101 | AI 设置页面样式优化 | P0 | 8 |
| F-102 | 模型下拉选择框优化 | P0 | 12 |
| F-103 | 模型列表刷新功能 | P1 | 8 |
| F-104 | 智能错误提示 | P0 | 10 |
| F-105 | 侧边栏样式优化 | P0 | 10 |
| F-106 | 多轮对话交互 | P1 | 8 |
| F-107 | 结果 JSON 结构化呈现 | P0 | 10 |
| F-108 | 优化结果应用/撤回 | P0 | 10 |
| F-109 | 提示词部分可编辑 | P2 | 8 |
| F-110 | AI 重新调用 | P1 | 6 |
| F-111 | Token 使用统计 | P1 | 8 |
| F-112 | 任务概述字段 | P1 | 10 |
| F-201 | 撤回功能增强 | P0 | 4 |
| F-202 | 会话管理优化 | P1 | 3 |
| F-203 | 界面交互精简 | P1 | 3 |
| F-204 | 悬浮按钮位置 | P2 | 2 |

**总计**: 120 个测试用例

### 2.2 测试不涵盖范围

- AI 模型返回结果的准确性（属于模型能力范畴）
- 第三方 API 的可用性
- 后端服务性能

---

## 3. 测试用例

### 3.1 F-101 AI 设置页面样式优化

#### TC-F101-001 验证设置弹窗基本布局

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F101-001 |
| **测试目标** | 验证 AI 设置弹窗的整体布局符合设计规范 |
| **前置条件** | 应用已加载完成 |
| **测试步骤** | 1. 点击 AI 设置按钮<br>2. 观察弹窗布局结构 |
| **预期结果** | 1. 弹窗居中显示<br>2. 包含渐变头部区域<br>3. 头部显示"AI 设置"标题和描述文本<br>4. 表单区域包含 API Key、Base URL、模型选择字段<br>5. 底部包含"取消"和"保存配置"按钮 |
| **优先级** | P0 |

#### TC-F101-002 验证弹窗宽度规范

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F101-002 |
| **测试目标** | 验证弹窗宽度符合 448px (max-w-md) 规范 |
| **前置条件** | 桌面端浏览器窗口宽度 >= 1024px |
| **测试步骤** | 1. 打开 AI 设置弹窗<br>2. 使用开发者工具检查弹窗容器宽度 |
| **预期结果** | 弹窗宽度最大为 448px |
| **优先级** | P0 |

#### TC-F101-003 验证头部渐变样式

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F101-003 |
| **测试目标** | 验证头部区域使用蓝-紫渐变背景 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 观察头部区域背景色<br>2. 检查标题和描述文字颜色 |
| **预期结果** | 1. 头部背景为蓝到紫的渐变色 (from-blue-500 to-purple-600)<br>2. 标题为白色<br>3. 描述文字为半透明白色 |
| **优先级** | P1 |

#### TC-F101-004 验证 API Key 输入框密码可见切换

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F101-004 |
| **测试目标** | 验证 API Key 输入框支持密码可见/隐藏切换 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 在 API Key 输入框输入内容<br>2. 点击眼睛图标切换可见性<br>3. 再次点击切换 |
| **预期结果** | 1. 默认显示为密码形式 (****)<br>2. 点击后显示明文<br>3. 再次点击恢复密码形式 |
| **优先级** | P0 |

#### TC-F101-005 验证表单字段标签样式

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F101-005 |
| **测试目标** | 验证表单字段标签使用加粗样式 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 观察各字段标签文本样式 |
| **预期结果** | 1. 标签文本使用 font-medium 加粗<br>2. 标签前有对应图标 |
| **优先级** | P2 |

#### TC-F101-006 验证辅助提示文本

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F101-006 |
| **测试目标** | 验证模型选择器下方显示辅助提示 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 观察模型选择器下方文本 |
| **预期结果** | 显示"支持手动输入任意模型名称"灰色小字提示 |
| **优先级** | P2 |

#### TC-F101-007 验证移动端弹窗适配（底部抽屉）

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F101-007 |
| **测试目标** | 验证移动端弹窗以底部抽屉形式展示 |
| **前置条件** | 浏览器窗口宽度 < 768px |
| **测试步骤** | 1. 打开 AI 设置弹窗<br>2. 观察弹窗位置和样式 |
| **预期结果** | 1. 弹窗从底部滑出<br>2. 顶部有圆角<br>3. 显示拖拽条<br>4. 最大高度 80vh |
| **优先级** | P0 |

#### TC-F101-008 验证弹窗关闭交互

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F101-008 |
| **测试目标** | 验证弹窗可通过多种方式关闭 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 点击"取消"按钮<br>2. 重新打开弹窗，按 Escape 键<br>3. 重新打开弹窗，点击弹窗外区域 |
| **预期结果** | 三种方式均可正常关闭弹窗 |
| **优先级** | P0 |

---

### 3.2 F-102 模型下拉选择框优化

#### TC-F102-001 验证下拉选择基本功能

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-001 |
| **测试目标** | 验证模型选择器支持下拉选择功能 |
| **前置条件** | AI 设置弹窗已打开，模型列表已缓存 |
| **测试步骤** | 1. 点击模型选择输入框<br>2. 观察下拉列表展开<br>3. 点击选择一个模型 |
| **预期结果** | 1. 下拉列表正常展开<br>2. 显示可用模型列表<br>3. 选中后输入框显示选中模型名称<br>4. 下拉列表收起 |
| **优先级** | P0 |

#### TC-F102-002 验证搜索过滤功能

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-002 |
| **测试目标** | 验证输入文本可实时过滤模型列表 |
| **前置条件** | AI 设置弹窗已打开，模型列表包含多个模型 |
| **测试步骤** | 1. 点击模型选择输入框<br>2. 输入"gpt"<br>3. 观察列表过滤结果 |
| **预期结果** | 1. 仅显示名称包含"gpt"的模型<br>2. 匹配部分高亮显示<br>3. 过滤实时生效 |
| **优先级** | P0 |

#### TC-F102-003 验证手动输入任意模型名称

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-003 |
| **测试目标** | 验证用户可直接输入任意模型名称 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 在模型输入框中输入"my-custom-model"<br>2. 点击其他位置使输入框失焦<br>3. 点击保存配置 |
| **预期结果** | 1. 输入框接受任意文本输入<br>2. 配置可正常保存<br>3. 不强制要求从列表选择 |
| **优先级** | P0 |

#### TC-F102-004 验证无匹配结果提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-004 |
| **测试目标** | 验证搜索无匹配时显示友好提示 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 在模型输入框中输入"xyz123notexist"<br>2. 观察下拉列表状态 |
| **预期结果** | 下拉列表显示"无匹配结果，将使用输入值"提示 |
| **优先级** | P1 |

#### TC-F102-005 验证模型分组展示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-005 |
| **测试目标** | 验证模型列表按厂商分组展示（如有分组数据） |
| **前置条件** | 模型列表包含多个厂商的模型 |
| **测试步骤** | 1. 打开模型选择下拉列表<br>2. 观察列表结构 |
| **预期结果** | 1. 模型按厂商分组（OpenAI、Anthropic 等）<br>2. 分组标题使用灰色小字<br>3. 分组之间有视觉分隔 |
| **优先级** | P2 |

#### TC-F102-006 验证推荐模型标识

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-006 |
| **测试目标** | 验证推荐模型显示"推荐"标签 |
| **前置条件** | 模型列表包含推荐模型配置 |
| **测试步骤** | 1. 打开模型选择下拉列表<br>2. 查找推荐模型 |
| **预期结果** | 推荐模型名称后显示蓝色"推荐"徽章 |
| **优先级** | P2 |

#### TC-F102-007 验证输入框聚焦样式

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-007 |
| **测试目标** | 验证输入框聚焦时边框高亮 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 点击模型选择输入框使其获得焦点<br>2. 观察边框样式 |
| **预期结果** | 输入框边框变为主色（border-primary）高亮显示 |
| **优先级** | P1 |

#### TC-F102-008 验证键盘导航

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-008 |
| **测试目标** | 验证可使用键盘在下拉列表中导航 |
| **前置条件** | 模型选择下拉列表已展开 |
| **测试步骤** | 1. 按下方向键 Down 导航到下一项<br>2. 按上方向键 Up 导航到上一项<br>3. 按 Enter 键选中当前项 |
| **预期结果** | 1. 方向键可在列表项间移动焦点<br>2. 当前焦点项有高亮样式<br>3. Enter 键可选中并填充输入框 |
| **优先级** | P1 |

#### TC-F102-009 验证下拉列表最大高度

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-009 |
| **测试目标** | 验证下拉列表有最大高度限制并支持滚动 |
| **前置条件** | 模型列表超过 10 个 |
| **测试步骤** | 1. 展开模型选择下拉列表<br>2. 观察列表高度<br>3. 尝试滚动列表 |
| **预期结果** | 1. 下拉列表最大高度约 240px (max-h-60)<br>2. 超出部分可滚动<br>3. 滚动条样式符合设计规范 |
| **优先级** | P1 |

#### TC-F102-010 验证空模型列表状态

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-010 |
| **测试目标** | 验证模型列表为空时的显示 |
| **前置条件** | 清除本地模型缓存 |
| **测试步骤** | 1. 展开模型选择下拉列表 |
| **预期结果** | 1. 显示空状态提示<br>2. 提示点击刷新按钮获取模型列表<br>3. 输入框仍可手动输入 |
| **优先级** | P1 |

#### TC-F102-011 验证长模型名称显示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-011 |
| **测试目标** | 验证长模型名称正确截断显示 |
| **前置条件** | 模型列表包含名称超长的模型 |
| **测试步骤** | 1. 展开模型选择下拉列表<br>2. 观察长名称模型的显示<br>3. 选中该模型 |
| **预期结果** | 1. 列表中长名称以省略号截断<br>2. 悬停时显示完整名称（tooltip）<br>3. 输入框中显示完整名称或合理截断 |
| **优先级** | P2 |

#### TC-F102-012 验证模型选择持久化

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F102-012 |
| **测试目标** | 验证选择的模型保存后再次打开仍显示 |
| **前置条件** | 已保存过模型配置 |
| **测试步骤** | 1. 选择一个模型并保存<br>2. 关闭设置弹窗<br>3. 重新打开设置弹窗 |
| **预期结果** | 模型输入框显示之前保存的模型名称 |
| **优先级** | P0 |

---

### 3.3 F-103 模型列表刷新功能

#### TC-F103-001 验证刷新按钮位置

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F103-001 |
| **测试目标** | 验证刷新按钮位于模型选择器右侧 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 定位模型选择器区域<br>2. 查找刷新按钮位置 |
| **预期结果** | 刷新按钮在模型选择器标签行右侧，显示刷新图标和"刷新"文字 |
| **优先级** | P0 |

#### TC-F103-002 验证刷新成功流程

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F103-002 |
| **测试目标** | 验证点击刷新按钮成功获取模型列表 |
| **前置条件** | 已配置有效的 API Key 和 Base URL |
| **测试步骤** | 1. 点击刷新按钮<br>2. 观察加载状态<br>3. 等待请求完成 |
| **预期结果** | 1. 按钮显示加载状态（loading spinner）<br>2. 按钮文字变为"刷新中..."<br>3. 成功后按钮显示绿色勾选和"已更新"<br>4. 模型列表更新 |
| **优先级** | P0 |

#### TC-F103-003 验证刷新失败提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F103-003 |
| **测试目标** | 验证刷新失败时显示错误提示 |
| **前置条件** | API Key 无效或网络不可用 |
| **测试步骤** | 1. 配置错误的 API Key<br>2. 点击刷新按钮<br>3. 等待请求完成 |
| **预期结果** | 1. 显示错误提示 Toast 或 Alert<br>2. 按钮恢复默认状态<br>3. 错误提示包含原因说明 |
| **优先级** | P0 |

#### TC-F103-004 验证刷新按钮加载中禁用

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F103-004 |
| **测试目标** | 验证刷新过程中按钮不可重复点击 |
| **前置条件** | AI 设置弹窗已打开 |
| **测试步骤** | 1. 点击刷新按钮<br>2. 在加载过程中再次点击按钮 |
| **预期结果** | 加载过程中按钮处于禁用状态，无法重复触发请求 |
| **优先级** | P1 |

#### TC-F103-005 验证缓存机制

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F103-005 |
| **测试目标** | 验证成功获取的模型列表缓存到本地 |
| **前置条件** | 刷新成功获取模型列表 |
| **测试步骤** | 1. 刷新获取模型列表<br>2. 关闭设置弹窗<br>3. 重新打开设置弹窗<br>4. 检查 localStorage |
| **预期结果** | 1. 重新打开后列表直接从缓存加载<br>2. localStorage 中存在模型缓存数据 |
| **优先级** | P1 |

#### TC-F103-006 验证缓存过期提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F103-006 |
| **测试目标** | 验证缓存过期 24 小时后提示用户刷新 |
| **前置条件** | 模拟缓存时间超过 24 小时 |
| **测试步骤** | 1. 修改本地缓存时间戳为 25 小时前<br>2. 打开 AI 设置弹窗<br>3. 观察刷新按钮状态 |
| **预期结果** | 刷新按钮显示小红点，提示缓存已过期需要更新 |
| **优先级** | P2 |

#### TC-F103-007 验证不同 Base URL 独立缓存

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F103-007 |
| **测试目标** | 验证不同 Base URL 的模型列表独立缓存 |
| **前置条件** | 存在多个有效的 API 端点 |
| **测试步骤** | 1. 使用 URL A 刷新获取模型列表<br>2. 切换到 URL B 刷新获取模型列表<br>3. 切换回 URL A |
| **预期结果** | 1. 每个 URL 的缓存独立<br>2. 切换 URL 后显示对应的缓存模型列表<br>3. 缓存 Key 包含 URL 哈希 |
| **优先级** | P2 |

#### TC-F103-008 验证网络超时处理

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F103-008 |
| **测试目标** | 验证网络请求超时时的处理 |
| **前置条件** | 模拟网络延迟超过超时阈值 |
| **测试步骤** | 1. 配置一个响应极慢的 API 端点<br>2. 点击刷新按钮<br>3. 等待超时 |
| **预期结果** | 1. 超时后显示"请求超时"错误提示<br>2. 按钮恢复可用状态<br>3. 原有缓存列表保持不变 |
| **优先级** | P1 |

---

### 3.4 F-104 智能错误提示

#### TC-F104-001 验证 quota_exceeded 错误提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-001 |
| **测试目标** | 验证额度用尽错误的友好提示 |
| **前置条件** | AI 接口返回 quota_exceeded 错误 |
| **测试步骤** | 1. 触发 AI 调用<br>2. 模拟接口返回 quota_exceeded 错误<br>3. 观察错误提示 |
| **预期结果** | 1. 显示警告色 Alert 卡片<br>2. 标题为"当前模型免费额度已用完"<br>3. 建议操作：切换付费模型或充值<br>4. 提供"检查配置"按钮 |
| **优先级** | P0 |

#### TC-F104-002 验证 invalid_api_key 错误提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-002 |
| **测试目标** | 验证 API Key 无效错误的友好提示 |
| **前置条件** | AI 接口返回 invalid_api_key 错误 |
| **测试步骤** | 1. 配置错误的 API Key<br>2. 触发 AI 调用<br>3. 观察错误提示 |
| **预期结果** | 1. 显示错误色 Alert 卡片<br>2. 标题为"API Key 无效"<br>3. 建议检查配置<br>4. 提供"检查配置"按钮可直接打开设置 |
| **优先级** | P0 |

#### TC-F104-003 验证 rate_limit_exceeded 错误提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-003 |
| **测试目标** | 验证请求过于频繁错误的友好提示 |
| **前置条件** | AI 接口返回 rate_limit_exceeded 错误 |
| **测试步骤** | 1. 快速连续触发多次 AI 调用<br>2. 观察错误提示 |
| **预期结果** | 1. 显示警告色 Alert 卡片<br>2. 标题为"请求过于频繁"<br>3. 建议稍后再试 |
| **优先级** | P0 |

#### TC-F104-004 验证 model_not_found 错误提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-004 |
| **测试目标** | 验证模型不存在错误的友好提示 |
| **前置条件** | 配置了不存在的模型名称 |
| **测试步骤** | 1. 配置模型为"nonexistent-model"<br>2. 触发 AI 调用<br>3. 观察错误提示 |
| **预期结果** | 1. 显示错误色 Alert 卡片<br>2. 标题为"模型不存在"<br>3. 建议选择其他模型<br>4. 提供"更换模型"按钮 |
| **优先级** | P0 |

#### TC-F104-005 验证 network_error 错误提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-005 |
| **测试目标** | 验证网络错误的友好提示 |
| **前置条件** | 网络不可用或 Base URL 不可达 |
| **测试步骤** | 1. 断开网络连接<br>2. 触发 AI 调用<br>3. 观察错误提示 |
| **预期结果** | 1. 显示错误色 Alert 卡片<br>2. 标题为"网络连接失败"<br>3. 建议检查网络或 Base URL |
| **优先级** | P0 |

#### TC-F104-006 验证原始错误详情折叠展示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-006 |
| **测试目标** | 验证可折叠查看原始错误信息 |
| **前置条件** | 已显示错误 Alert 卡片 |
| **测试步骤** | 1. 点击"查看详情"按钮<br>2. 观察折叠区域展开 |
| **预期结果** | 1. 展开显示原始错误 JSON<br>2. 使用等宽字体<br>3. 支持横向滚动（内容过长时） |
| **优先级** | P1 |

#### TC-F104-007 验证 Toast 快捷提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-007 |
| **测试目标** | 验证非阻塞性错误使用 Toast 提示 |
| **前置条件** | 触发非阻塞性错误（如网络超时） |
| **测试步骤** | 1. 触发网络超时错误<br>2. 观察 Toast 提示 |
| **预期结果** | 1. Toast 在页面顶部中央显示<br>2. 包含错误图标和简短描述<br>3. 提供关闭按钮<br>4. 自动消失（约 5 秒后） |
| **优先级** | P1 |

#### TC-F104-008 验证未知错误处理

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-008 |
| **测试目标** | 验证未知类型错误的处理 |
| **前置条件** | AI 接口返回未预期的错误格式 |
| **测试步骤** | 1. 模拟接口返回非标准错误<br>2. 观察错误提示 |
| **预期结果** | 1. 显示"未知错误"标题<br>2. 建议查看详情<br>3. 原始错误信息完整保留 |
| **优先级** | P1 |

#### TC-F104-009 验证错误提示可关闭

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-009 |
| **测试目标** | 验证 Alert 错误卡片可关闭 |
| **前置条件** | 已显示错误 Alert 卡片 |
| **测试步骤** | 1. 点击错误卡片的关闭按钮（如有）<br>2. 或点击卡片外区域 |
| **预期结果** | 错误提示可被用户关闭，恢复正常界面 |
| **优先级** | P2 |

#### TC-F104-010 验证错误提示 ARIA 属性

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F104-010 |
| **测试目标** | 验证错误提示符合可访问性规范 |
| **前置条件** | 已显示错误提示 |
| **测试步骤** | 1. 使用开发者工具检查 ARIA 属性<br>2. 使用屏幕阅读器测试 |
| **预期结果** | 1. 错误区域有 role="alert"<br>2. aria-live="assertive"<br>3. 屏幕阅读器自动朗读错误内容 |
| **优先级** | P2 |

---

### 3.5 F-105 侧边栏样式优化

#### TC-F105-001 验证侧边栏基本布局

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-001 |
| **测试目标** | 验证 AI 侧边栏的整体布局结构 |
| **前置条件** | AI 功能已配置完成 |
| **测试步骤** | 1. 触发打开 AI 侧边栏<br>2. 观察布局结构 |
| **预期结果** | 1. 侧边栏从右侧滑出<br>2. 包含固定头部（标题、清空按钮、关闭按钮）<br>3. 中间为可滚动的对话区域<br>4. 底部为固定的输入区域 |
| **优先级** | P0 |

#### TC-F105-002 验证侧边栏宽度规范

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-002 |
| **测试目标** | 验证不同设备的侧边栏宽度 |
| **前置条件** | AI 侧边栏已打开 |
| **测试步骤** | 1. 桌面端 (>=1024px) 检查宽度<br>2. 平板端 (768-1023px) 检查宽度<br>3. 移动端 (<768px) 检查宽度 |
| **预期结果** | 1. 桌面端宽度 420px<br>2. 平板端宽度 380px<br>3. 移动端全宽显示 |
| **优先级** | P0 |

#### TC-F105-003 验证侧边栏宽度可调节

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-003 |
| **测试目标** | 验证桌面端侧边栏支持拖拽调整宽度 |
| **前置条件** | 桌面端 AI 侧边栏已打开 |
| **测试步骤** | 1. 将鼠标移动到侧边栏左边缘<br>2. 光标变为调整光标后拖拽<br>3. 调整到不同宽度 |
| **预期结果** | 1. 可拖拽调整宽度<br>2. 最小宽度 320px<br>3. 最大宽度 520px |
| **优先级** | P1 |

#### TC-F105-004 验证用户消息气泡样式

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-004 |
| **测试目标** | 验证用户消息气泡样式正确 |
| **前置条件** | 已发送用户消息 |
| **测试步骤** | 1. 发送一条消息<br>2. 观察消息气泡样式 |
| **预期结果** | 1. 气泡位于右侧 (chat-end)<br>2. 使用主色背景 (chat-bubble-primary)<br>3. 显示"用户"标签和时间 |
| **优先级** | P0 |

#### TC-F105-005 验证 AI 消息气泡样式

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-005 |
| **测试目标** | 验证 AI 消息气泡样式正确 |
| **前置条件** | AI 已返回响应 |
| **测试步骤** | 1. 等待 AI 响应<br>2. 观察 AI 消息气泡样式 |
| **预期结果** | 1. 气泡位于左侧 (chat-start)<br>2. 使用浅色背景 (bg-base-200)<br>3. 显示"AI"标签和时间 |
| **优先级** | P0 |

#### TC-F105-006 验证 Markdown 渲染支持

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-006 |
| **测试目标** | 验证 AI 消息支持 Markdown 渲染 |
| **前置条件** | AI 返回包含 Markdown 格式的响应 |
| **测试步骤** | 1. 触发 AI 返回包含标题、列表、加粗等 Markdown 的响应<br>2. 观察渲染效果 |
| **预期结果** | 1. 标题正确渲染<br>2. 列表正确显示<br>3. 加粗、斜体等格式正确 |
| **优先级** | P0 |

#### TC-F105-007 验证代码块语法高亮

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-007 |
| **测试目标** | 验证代码块支持语法高亮 |
| **前置条件** | AI 返回包含代码块的响应 |
| **测试步骤** | 1. 触发 AI 返回包含 JavaScript 代码块的响应<br>2. 观察代码块渲染 |
| **预期结果** | 1. 代码块有背景区分<br>2. 语法关键词有颜色高亮<br>3. 支持横向滚动（代码过长时） |
| **优先级** | P1 |

#### TC-F105-008 验证侧边栏动画效果

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-008 |
| **测试目标** | 验证侧边栏打开/关闭动画 |
| **前置条件** | AI 侧边栏处于关闭状态 |
| **测试步骤** | 1. 打开侧边栏，观察动画<br>2. 关闭侧边栏，观察动画 |
| **预期结果** | 1. 打开时从右侧滑入，动画 300ms<br>2. 关闭时向右滑出，动画 200ms<br>3. 动画流畅无卡顿 |
| **优先级** | P1 |

#### TC-F105-009 验证侧边栏 Escape 键关闭

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-009 |
| **测试目标** | 验证按 Escape 键可关闭侧边栏 |
| **前置条件** | AI 侧边栏已打开 |
| **测试步骤** | 1. 按键盘 Escape 键 |
| **预期结果** | 侧边栏关闭 |
| **优先级** | P1 |

#### TC-F105-010 验证移动端侧边栏样式

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F105-010 |
| **测试目标** | 验证移动端侧边栏全屏覆盖显示 |
| **前置条件** | 浏览器窗口宽度 < 768px |
| **测试步骤** | 1. 打开 AI 侧边栏<br>2. 观察显示效果 |
| **预期结果** | 1. 侧边栏全宽显示<br>2. 高度 80vh<br>3. 有背景遮罩 |
| **优先级** | P0 |

---

### 3.6 F-106 多轮对话交互

#### TC-F106-001 验证对话历史显示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F106-001 |
| **测试目标** | 验证对话历史完整显示 |
| **前置条件** | 已进行多轮对话 |
| **测试步骤** | 1. 发送消息 A<br>2. 等待 AI 响应<br>3. 发送消息 B<br>4. 等待 AI 响应<br>5. 观察对话历史 |
| **预期结果** | 1. 所有消息按时间顺序显示<br>2. 用户消息和 AI 消息交替排列<br>3. 每条消息显示时间戳 |
| **优先级** | P0 |

#### TC-F106-002 验证清空对话功能

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F106-002 |
| **测试目标** | 验证可清空所有对话记录 |
| **前置条件** | 存在对话历史 |
| **测试步骤** | 1. 点击头部"清空"按钮<br>2. 在确认弹窗中点击"清空" |
| **预期结果** | 1. 显示确认弹窗<br>2. 确认后所有对话记录清空<br>3. 侧边栏显示空状态 |
| **优先级** | P0 |

#### TC-F106-003 验证清空对话确认弹窗

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F106-003 |
| **测试目标** | 验证清空前有确认弹窗 |
| **前置条件** | 存在对话历史 |
| **测试步骤** | 1. 点击"清空"按钮<br>2. 观察确认弹窗<br>3. 点击"取消" |
| **预期结果** | 1. 弹窗显示警告文案"确定要清空所有对话记录吗？此操作无法撤销"<br>2. 提供"取消"和"清空"按钮<br>3. 点击取消后对话保留 |
| **优先级** | P1 |

#### TC-F106-004 验证上下文自动携带

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F106-004 |
| **测试目标** | 验证后续消息自动携带历史上下文 |
| **前置条件** | 已有对话历史 |
| **测试步骤** | 1. 发送消息"我叫张三"<br>2. 等待 AI 响应<br>3. 发送"我叫什么名字？" |
| **预期结果** | AI 响应能够引用之前的上下文，正确回答"张三" |
| **优先级** | P0 |

#### TC-F106-005 验证对话滚动行为

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F106-005 |
| **测试目标** | 验证新消息自动滚动到底部 |
| **前置条件** | 对话历史超过可视区域 |
| **测试步骤** | 1. 滚动到历史消息<br>2. 发送新消息<br>3. 等待 AI 响应 |
| **预期结果** | 1. 发送消息后自动滚动到底部<br>2. AI 响应时持续滚动跟随 |
| **优先级** | P1 |

#### TC-F106-006 验证对话区域手动滚动

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F106-006 |
| **测试目标** | 验证可手动滚动查看历史 |
| **前置条件** | 对话历史超过可视区域 |
| **测试步骤** | 1. 使用鼠标滚轮向上滚动<br>2. 使用滚动条拖动 |
| **预期结果** | 可正常滚动查看历史消息 |
| **优先级** | P1 |

#### TC-F106-007 验证空对话状态

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F106-007 |
| **测试目标** | 验证无对话时的空状态显示 |
| **前置条件** | 无对话历史 |
| **测试步骤** | 1. 打开 AI 侧边栏<br>2. 观察对话区域 |
| **预期结果** | 显示友好的空状态提示，引导用户开始对话 |
| **优先级** | P2 |

#### TC-F106-008 验证上下文长度配置

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F106-008 |
| **测试目标** | 验证可配置上下文保留轮数 |
| **前置条件** | 设置中存在上下文配置项 |
| **测试步骤** | 1. 在设置中配置上下文保留 3 轮<br>2. 进行 5 轮对话<br>3. 检查发送给 AI 的上下文 |
| **预期结果** | 仅最近 3 轮对话作为上下文发送 |
| **优先级** | P2 |

---

### 3.7 F-107 结果 JSON 结构化呈现

#### TC-F107-001 验证任务润色结果展示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-001 |
| **测试目标** | 验证 task_refine 类型结果正确展示 |
| **前置条件** | AI 返回 task_refine 类型 JSON |
| **测试步骤** | 1. 触发任务名称优化<br>2. 等待 AI 返回结果<br>3. 观察结果展示 |
| **预期结果** | 1. 显示结果卡片<br>2. 左侧显示"原始"内容（红色背景、删除线）<br>3. 右侧显示"优化后"内容（绿色背景）<br>4. 底部有"应用"和"撤回"按钮 |
| **优先级** | P0 |

#### TC-F107-002 验证推理过程折叠展示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-002 |
| **测试目标** | 验证 reasoning 字段可折叠展示 |
| **前置条件** | AI 返回包含 reasoning 字段的结果 |
| **测试步骤** | 1. 观察结果卡片<br>2. 点击"查看优化理由" |
| **预期结果** | 1. reasoning 默认折叠<br>2. 点击后展开显示优化理由<br>3. 再次点击可折叠 |
| **优先级** | P1 |

#### TC-F107-003 验证根据 type 字段动态渲染

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-003 |
| **测试目标** | 验证不同 type 使用不同渲染器 |
| **前置条件** | 存在多种 Agent 类型 |
| **测试步骤** | 1. 触发 task_refine 类型<br>2. 触发其他类型（如 task_split）<br>3. 对比展示方式 |
| **预期结果** | 不同 type 的结果使用对应的渲染器，展示样式不同 |
| **优先级** | P0 |

#### TC-F107-004 验证渲染器架构可扩展性

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-004 |
| **测试目标** | 验证新增 Agent 类型时渲染器易于扩展 |
| **前置条件** | 需要新增一种 Agent 类型 |
| **测试步骤** | 1. 模拟新增 text_polish 类型<br>2. 注册对应渲染器<br>3. 验证渲染效果 |
| **预期结果** | 1. 仅需添加渲染器配置<br>2. 无需修改核心渲染逻辑<br>3. 新类型正确渲染 |
| **优先级** | P1 |

#### TC-F107-005 验证未知 type 的降级处理

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-005 |
| **测试目标** | 验证未注册的 type 有降级展示 |
| **前置条件** | AI 返回未注册的 type |
| **测试步骤** | 1. 模拟返回 type: "unknown_type"<br>2. 观察展示效果 |
| **预期结果** | 1. 不报错<br>2. 使用默认渲染器展示 JSON 内容<br>3. 或显示原始 JSON 格式 |
| **优先级** | P1 |

#### TC-F107-006 验证结果卡片样式

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-006 |
| **测试目标** | 验证结果卡片视觉样式符合设计规范 |
| **前置条件** | 已显示结果卡片 |
| **测试步骤** | 1. 检查卡片背景色<br>2. 检查边框圆角<br>3. 检查内边距 |
| **预期结果** | 1. 使用 bg-base-200 背景<br>2. 有阴影效果 shadow-sm<br>3. 内边距 16px (p-4) |
| **优先级** | P1 |

#### TC-F107-007 验证对比展示布局

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-007 |
| **测试目标** | 验证原始/优化后两栏并排显示 |
| **前置条件** | 已显示 task_refine 结果 |
| **测试步骤** | 1. 观察对比区域布局 |
| **预期结果** | 1. 使用两列网格布局 (grid-cols-2)<br>2. 原始在左，优化后在右<br>3. 有明显的颜色区分 |
| **优先级** | P0 |

#### TC-F107-008 验证长文本内容显示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-008 |
| **测试目标** | 验证长文本内容正确换行显示 |
| **前置条件** | 原始/优化后内容较长 |
| **测试步骤** | 1. 触发包含长文本的优化结果<br>2. 观察文本显示 |
| **预期结果** | 1. 文本自动换行<br>2. 不出现横向滚动条<br>3. 卡片高度自适应 |
| **优先级** | P1 |

#### TC-F107-009 验证流式输出时的渲染

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-009 |
| **测试目标** | 验证流式输出过程中结果逐步渲染 |
| **前置条件** | AI 使用流式返回结果 |
| **测试步骤** | 1. 触发 AI 调用<br>2. 观察流式输出过程 |
| **预期结果** | 1. 内容逐字/逐块显示<br>2. JSON 完整后自动解析并渲染为结构化卡片<br>3. 渲染过渡平滑 |
| **优先级** | P1 |

#### TC-F107-010 验证 JSON 解析错误处理

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F107-010 |
| **测试目标** | 验证 AI 返回非法 JSON 时的处理 |
| **前置条件** | AI 返回格式错误的 JSON |
| **测试步骤** | 1. 模拟返回非法 JSON<br>2. 观察错误处理 |
| **预期结果** | 1. 不报错<br>2. 显示原始文本内容<br>3. 或显示解析错误提示 |
| **优先级** | P1 |

---

### 3.8 F-108 优化结果应用/撤回

#### TC-F108-001 验证应用按钮功能

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-001 |
| **测试目标** | 验证点击"应用"按钮更新原始数据 |
| **前置条件** | 已显示优化结果卡片 |
| **测试步骤** | 1. 点击"应用"按钮<br>2. 检查原始任务数据 |
| **预期结果** | 1. 任务名称更新为优化后的值<br>2. 显示成功 Toast 提示<br>3. 按钮变为"已应用"禁用状态 |
| **优先级** | P0 |

#### TC-F108-002 验证撤回按钮功能

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-002 |
| **测试目标** | 验证点击"撤回"按钮恢复原始值 |
| **前置条件** | 已应用优化结果 |
| **测试步骤** | 1. 应用优化结果<br>2. 点击"撤回"按钮<br>3. 检查任务数据 |
| **预期结果** | 1. 任务名称恢复为原始值<br>2. 显示撤回成功提示<br>3. 按钮状态恢复 |
| **优先级** | P0 |

#### TC-F108-003 验证应用后按钮状态变化

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-003 |
| **测试目标** | 验证应用后按钮状态正确 |
| **前置条件** | 已显示优化结果卡片 |
| **测试步骤** | 1. 点击"应用"按钮<br>2. 观察按钮状态变化 |
| **预期结果** | 1. "应用"按钮变为绿色"已应用"<br>2. 按钮处于禁用状态<br>3. "撤回"按钮仍可点击 |
| **优先级** | P0 |

#### TC-F108-004 验证撤回时限提示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-004 |
| **测试目标** | 验证撤回按钮显示倒计时（如有时限） |
| **前置条件** | 刚应用优化结果 |
| **测试步骤** | 1. 点击"应用"按钮<br>2. 观察撤回按钮状态 |
| **预期结果** | 撤回按钮显示倒计时"撤回 (5s)"，倒计时结束后撤回功能失效 |
| **优先级** | P2 |

#### TC-F108-005 验证应用操作的 Toast 反馈

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-005 |
| **测试目标** | 验证应用操作后有明确反馈 |
| **前置条件** | 已显示优化结果卡片 |
| **测试步骤** | 1. 点击"应用"按钮<br>2. 观察 Toast 提示 |
| **预期结果** | 显示绿色成功 Toast："已应用优化结果" |
| **优先级** | P1 |

#### TC-F108-006 验证撤回操作的反馈

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-006 |
| **测试目标** | 验证撤回操作后有明确反馈 |
| **前置条件** | 已应用优化结果 |
| **测试步骤** | 1. 点击"撤回"按钮<br>2. 观察反馈 |
| **预期结果** | 显示 Toast："已撤回，恢复原始值" |
| **优先级** | P1 |

#### TC-F108-007 验证未应用时撤回按钮状态

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-007 |
| **测试目标** | 验证未应用前撤回按钮行为 |
| **前置条件** | 优化结果尚未应用 |
| **测试步骤** | 1. 观察撤回按钮状态 |
| **预期结果** | 未应用前撤回按钮可能：1) 隐藏 2) 禁用 3) 点击无效果 |
| **优先级** | P2 |

#### TC-F108-008 验证多次优化后的应用/撤回

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-008 |
| **测试目标** | 验证多次优化后应用/撤回的正确性 |
| **前置条件** | 对同一任务进行多次优化 |
| **测试步骤** | 1. 优化任务获得结果 A<br>2. 应用结果 A<br>3. 再次优化获得结果 B<br>4. 应用结果 B<br>5. 撤回 |
| **预期结果** | 撤回后恢复到最近一次应用前的状态（即结果 A） |
| **优先级** | P1 |

#### TC-F108-009 验证应用失败处理

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-009 |
| **测试目标** | 验证应用操作失败时的处理 |
| **前置条件** | 模拟应用操作失败 |
| **测试步骤** | 1. 模拟数据更新失败<br>2. 点击"应用"按钮<br>3. 观察错误处理 |
| **预期结果** | 1. 显示错误提示<br>2. 按钮保持可用状态<br>3. 原数据不变 |
| **优先级** | P1 |

#### TC-F108-010 验证键盘快捷键操作

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F108-010 |
| **测试目标** | 验证可使用键盘操作应用/撤回 |
| **前置条件** | 结果卡片获得焦点 |
| **测试步骤** | 1. Tab 键切换到"应用"按钮<br>2. Enter 键触发应用<br>3. Tab 键切换到"撤回"按钮<br>4. Enter 键触发撤回 |
| **预期结果** | 可完全使用键盘完成操作 |
| **优先级** | P2 |

---

### 3.9 F-109 提示词部分可编辑

#### TC-F109-001 验证高级设置折叠面板

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F109-001 |
| **测试目标** | 验证高级设置在折叠面板中 |
| **前置条件** | AI 侧边栏已打开 |
| **测试步骤** | 1. 查找"高级设置"折叠面板<br>2. 点击展开 |
| **预期结果** | 1. 存在高级设置折叠面板<br>2. 默认折叠状态<br>3. 点击后展开显示设置项 |
| **优先级** | P1 |

#### TC-F109-002 验证可编辑区域

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F109-002 |
| **测试目标** | 验证用户指令区域可编辑 |
| **前置条件** | 高级设置面板已展开 |
| **测试步骤** | 1. 找到"用户指令"输入框<br>2. 编辑内容<br>3. 保存 |
| **预期结果** | 1. 输入框标记为"可编辑"<br>2. 可自由编辑文本<br>3. 编辑后内容生效 |
| **优先级** | P0 |

#### TC-F109-003 验证不可编辑区域

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F109-003 |
| **测试目标** | 验证输出格式等区域不可编辑 |
| **前置条件** | 高级设置面板已展开 |
| **测试步骤** | 1. 找到"输出格式"区域<br>2. 尝试编辑 |
| **预期结果** | 1. 区域标记为"只读"<br>2. 显示为灰色/半透明<br>3. 无法编辑内容 |
| **优先级** | P0 |

#### TC-F109-004 验证恢复默认按钮

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F109-004 |
| **测试目标** | 验证可恢复默认提示词 |
| **前置条件** | 已修改用户指令内容 |
| **测试步骤** | 1. 修改用户指令<br>2. 点击"恢复默认"按钮 |
| **预期结果** | 1. 提示词恢复为默认值<br>2. 显示恢复成功提示 |
| **优先级** | P0 |

#### TC-F109-005 验证编辑后实时预览

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F109-005 |
| **测试目标** | 验证编辑后可预览最终 Prompt（可选功能） |
| **前置条件** | 已修改用户指令 |
| **测试步骤** | 1. 修改用户指令<br>2. 查看预览区域 |
| **预期结果** | 显示组合后的完整 Prompt 预览 |
| **优先级** | P2 |

#### TC-F109-006 验证编辑后生效

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F109-006 |
| **测试目标** | 验证修改的提示词在 AI 调用中生效 |
| **前置条件** | 已修改用户指令 |
| **测试步骤** | 1. 修改用户指令为特定内容<br>2. 触发 AI 调用<br>3. 检查发送的 Prompt |
| **预期结果** | 发送给 AI 的 Prompt 包含修改后的用户指令 |
| **优先级** | P0 |

#### TC-F109-007 验证输入框样式

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F109-007 |
| **测试目标** | 验证可编辑输入框样式正确 |
| **前置条件** | 高级设置面板已展开 |
| **测试步骤** | 1. 观察用户指令输入框样式 |
| **预期结果** | 1. 使用 textarea 组件<br>2. 有边框样式 (textarea-bordered)<br>3. 高度适中 (h-20) |
| **优先级** | P2 |

#### TC-F109-008 验证提示词持久化

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F109-008 |
| **测试目标** | 验证修改的提示词保存后持久化 |
| **前置条件** | 已修改并保存用户指令 |
| **测试步骤** | 1. 修改用户指令<br>2. 关闭侧边栏<br>3. 重新打开侧边栏<br>4. 检查用户指令内容 |
| **预期结果** | 修改后的用户指令仍然保留 |
| **优先级** | P1 |

---

### 3.10 F-110 AI 重新调用

#### TC-F110-001 验证重新生成按钮位置

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F110-001 |
| **测试目标** | 验证重新生成按钮在 AI 回复下方 |
| **前置条件** | AI 已返回响应 |
| **测试步骤** | 1. 查找 AI 消息气泡<br>2. 定位重新生成按钮 |
| **预期结果** | 在 AI 消息气泡底部的操作区域，有刷新图标按钮 |
| **优先级** | P0 |

#### TC-F110-002 验证重新生成功能

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F110-002 |
| **测试目标** | 验证点击重新生成获取新结果 |
| **前置条件** | AI 已返回响应 |
| **测试步骤** | 1. 点击重新生成按钮<br>2. 等待新响应 |
| **预期结果** | 1. 显示加载状态<br>2. 使用相同输入重新调用 AI<br>3. 显示新的响应结果 |
| **优先级** | P0 |

#### TC-F110-003 验证重新生成加载状态

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F110-003 |
| **测试目标** | 验证重新生成时显示加载动画 |
| **前置条件** | AI 已返回响应 |
| **测试步骤** | 1. 点击重新生成按钮<br>2. 观察按钮状态 |
| **预期结果** | 按钮显示 loading spinner，禁用状态 |
| **优先级** | P1 |

#### TC-F110-004 验证新结果替换旧结果

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F110-004 |
| **测试目标** | 验证新结果替换或追加显示 |
| **前置条件** | 已有 AI 响应 |
| **测试步骤** | 1. 点击重新生成<br>2. 等待新响应<br>3. 观察结果展示 |
| **预期结果** | 新结果替换旧结果显示（或根据设计追加显示） |
| **优先级** | P0 |

#### TC-F110-005 验证重新生成失败处理

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F110-005 |
| **测试目标** | 验证重新生成失败时的处理 |
| **前置条件** | 模拟 AI 调用失败 |
| **测试步骤** | 1. 模拟网络错误<br>2. 点击重新生成<br>3. 等待结果 |
| **预期结果** | 1. 显示错误提示<br>2. 原有结果保留<br>3. 按钮恢复可用 |
| **优先级** | P1 |

#### TC-F110-006 验证按钮 Tooltip

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F110-006 |
| **测试目标** | 验证重新生成按钮有 Tooltip 提示 |
| **前置条件** | AI 已返回响应 |
| **测试步骤** | 1. 将鼠标悬停在重新生成按钮上 |
| **预期结果** | 显示"重新生成"Tooltip |
| **优先级** | P2 |

---

### 3.11 F-111 Token 使用统计

#### TC-F111-001 验证单次请求 Token 显示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F111-001 |
| **测试目标** | 验证 AI 回复显示本次 Token 使用 |
| **前置条件** | AI 已返回响应 |
| **测试步骤** | 1. 查看 AI 消息气泡<br>2. 定位 Token 统计信息 |
| **预期结果** | 显示格式如"Tokens: 150 (输入: 50 / 输出: 100)" |
| **优先级** | P0 |

#### TC-F111-002 验证 Token 数据来源

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F111-002 |
| **测试目标** | 验证 Token 数据来源于 API 响应 |
| **前置条件** | AI 调用返回包含 usage 字段 |
| **测试步骤** | 1. 触发 AI 调用<br>2. 检查 API 响应的 usage 字段<br>3. 对比界面显示 |
| **预期结果** | 界面显示的 Token 数与 API 响应 usage 字段一致 |
| **优先级** | P0 |

#### TC-F111-003 验证 Token 统计位置

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F111-003 |
| **测试目标** | 验证 Token 统计显示位置 |
| **前置条件** | AI 已返回响应 |
| **测试步骤** | 1. 观察 AI 消息气泡布局 |
| **预期结果** | Token 统计在消息气泡底部右侧，使用小字灰色显示 |
| **优先级** | P1 |

#### TC-F111-004 验证会话累计统计

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F111-004 |
| **测试目标** | 验证侧边栏显示会话累计 Token |
| **前置条件** | 已进行多轮对话 |
| **测试步骤** | 1. 进行 3 轮对话<br>2. 观察侧边栏底部统计 |
| **预期结果** | 显示"累计: X tokens"，数值为所有对话 Token 之和 |
| **优先级** | P1 |

#### TC-F111-005 验证累计统计位置

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F111-005 |
| **测试目标** | 验证累计统计在输入区上方 |
| **前置条件** | 存在对话历史 |
| **测试步骤** | 1. 观察侧边栏布局 |
| **预期结果** | 累计统计显示在输入框上方的条形区域中 |
| **优先级** | P1 |

#### TC-F111-006 验证清空对话后累计重置

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F111-006 |
| **测试目标** | 验证清空对话后累计 Token 重置 |
| **前置条件** | 存在对话历史和累计 Token |
| **测试步骤** | 1. 确认当前累计 Token > 0<br>2. 清空对话<br>3. 观察累计统计 |
| **预期结果** | 累计 Token 重置为 0 或隐藏统计区域 |
| **优先级** | P1 |

#### TC-F111-007 验证 API 不返回 usage 时的处理

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F111-007 |
| **测试目标** | 验证 API 响应无 usage 字段时的处理 |
| **前置条件** | API 响应不包含 usage 字段 |
| **测试步骤** | 1. 模拟 API 返回无 usage<br>2. 观察 Token 显示 |
| **预期结果** | 1. 不报错<br>2. Token 统计区域隐藏或显示"--" |
| **优先级** | P2 |

#### TC-F111-008 验证大数字格式化

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F111-008 |
| **测试目标** | 验证大 Token 数使用千分位格式 |
| **前置条件** | 累计 Token 超过 1000 |
| **测试步骤** | 1. 进行多轮对话使累计超过 1000<br>2. 观察累计统计显示 |
| **预期结果** | 显示格式如"1,234 tokens"，使用千分位分隔 |
| **优先级** | P2 |

---

### 3.12 F-112 任务概述字段

#### TC-F112-001 验证任务编辑弹窗新增字段

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-001 |
| **测试目标** | 验证任务编辑弹窗包含任务概述字段 |
| **前置条件** | 打开任务编辑弹窗 |
| **测试步骤** | 1. 双击任务打开编辑弹窗<br>2. 查找任务概述字段 |
| **预期结果** | 1. 存在"任务概述"字段<br>2. 标记为可选字段<br>3. 使用 Textarea 组件 |
| **优先级** | P0 |

#### TC-F112-002 验证任务概述多行输入

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-002 |
| **测试目标** | 验证任务概述支持多行文本输入 |
| **前置条件** | 任务编辑弹窗已打开 |
| **测试步骤** | 1. 在任务概述字段输入多行文本<br>2. 保存任务 |
| **预期结果** | 1. 可输入多行文本<br>2. 输入框高度适中 (h-24)<br>3. 多行内容正确保存 |
| **优先级** | P0 |

#### TC-F112-003 验证任务概述字符限制

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-003 |
| **测试目标** | 验证任务概述最大 500 字符 |
| **前置条件** | 任务编辑弹窗已打开 |
| **测试步骤** | 1. 输入超过 500 字符的文本<br>2. 观察处理方式 |
| **预期结果** | 1. 显示字符限制提示<br>2. 超出部分被截断或禁止输入 |
| **优先级** | P1 |

#### TC-F112-004 验证甘特图表格列显示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-004 |
| **测试目标** | 验证甘特图表格新增任务概述列 |
| **前置条件** | 存在带有任务概述的任务 |
| **测试步骤** | 1. 查看甘特图表格<br>2. 查找任务概述列 |
| **预期结果** | 1. 任务名称列后有任务概述列<br>2. 列宽约 250px |
| **优先级** | P0 |

#### TC-F112-005 验证概述省略显示

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-005 |
| **测试目标** | 验证长概述在表格中省略显示 |
| **前置条件** | 任务概述超过列宽 |
| **测试步骤** | 1. 添加一个长概述的任务<br>2. 查看表格显示 |
| **预期结果** | 1. 概述以省略号截断<br>2. 显示"..."表示有更多内容 |
| **优先级** | P0 |

#### TC-F112-006 验证悬停展开完整内容

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-006 |
| **测试目标** | 验证鼠标悬停展开完整概述 |
| **前置条件** | 任务概述被截断显示 |
| **测试步骤** | 1. 将鼠标悬停在概述单元格上<br>2. 等待 Tooltip 出现 |
| **预期结果** | 1. 显示浮层展示完整概述<br>2. 浮层最大宽度 400px<br>3. 有阴影和边框 |
| **优先级** | P0 |

#### TC-F112-007 验证数据持久化

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-007 |
| **测试目标** | 验证任务概述正确保存到数据结构 |
| **前置条件** | 已填写任务概述 |
| **测试步骤** | 1. 填写任务概述并保存<br>2. 刷新页面<br>3. 重新打开任务编辑 |
| **预期结果** | 任务概述数据保持不变 |
| **优先级** | P0 |

#### TC-F112-008 验证导出功能包含概述

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-008 |
| **测试目标** | 验证导出 Excel 包含任务概述列 |
| **前置条件** | 存在带概述的任务 |
| **测试步骤** | 1. 导出甘特图数据为 Excel<br>2. 打开导出文件 |
| **预期结果** | 1. Excel 包含任务概述列<br>2. 概述内容完整导出 |
| **优先级** | P0 |

#### TC-F112-009 验证导入功能支持概述

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-009 |
| **测试目标** | 验证导入 Excel 可读取任务概述 |
| **前置条件** | 准备包含任务概述列的 Excel 文件 |
| **测试步骤** | 1. 导入包含概述的 Excel<br>2. 检查导入的任务 |
| **预期结果** | 1. 任务概述正确导入<br>2. 多行文本保持格式 |
| **优先级** | P0 |

#### TC-F112-010 验证任务悬停信息包含概述

| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F112-010 |
| **测试目标** | 验证甘特图任务条悬停显示概述 |
| **前置条件** | 存在带概述的任务 |
| **测试步骤** | 1. 将鼠标悬停在甘特图任务条上<br>2. 观察悬停信息 |
| **预期结果** | 悬停信息卡片中显示任务概述 |
| **优先级** | P1 |

---

### 3.13 F-201 撤回功能增强

#### TC-F201-001 验证 AI 修改任务后撤回
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F201-001 |
| **测试目标** | 验证 AI 修改任务后使用 Ctrl+Z 能正确回滚 |
| **前置条件** | 1. 应用已加载<br>2. 选中一个任务 |
| **测试步骤** | 1. 使用 AI 优化该任务（如修改名称）并应用<br>2. 确认任务已更新<br>3. 按下 Ctrl+Z 快捷键 |
| **预期结果** | 1. 任务恢复到修改前的状态<br>2. 甘特图界面同步更新 |
| **优先级** | P0 |

#### TC-F201-002 验证连续撤回
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F201-002 |
| **测试目标** | 验证多次 AI 操作后可连续撤回 |
| **前置条件** | 对任务进行多次 AI 修改并应用 |
| **测试步骤** | 1. AI 修改任务 A 并应用<br>2. AI 修改任务 B 并应用<br>3. 连续按两次 Ctrl+Z |
| **预期结果** | 1. 第一次撤回恢复任务 B<br>2. 第二次撤回恢复任务 A |
| **优先级** | P0 |

#### TC-F201-003 验证撤回按钮与快捷键一致性
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F201-003 |
| **测试目标** | 验证界面上的撤回按钮与 Ctrl+Z 行为一致（如有全局撤回按钮） |
| **前置条件** | AI 修改任务并应用 |
| **测试步骤** | 1. 点击全局工具栏的撤回按钮（如有） |
| **预期结果** | 效果等同于 Ctrl+Z，任务恢复原状 |
| **优先级** | P1 |

#### TC-F201-004 验证撤回后的重做 (Redo)
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F201-004 |
| **测试目标** | 验证撤回 AI 操作后可重做 |
| **前置条件** | 已撤回 AI 的修改 |
| **测试步骤** | 1. 按下 Ctrl+Y (或 Ctrl+Shift+Z) |
| **预期结果** | 任务重新应用 AI 的修改 |
| **优先级** | P1 |

---

### 3.14 F-202 会话管理优化

#### TC-F202-001 验证重新打开抽屉清空历史
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F202-001 |
| **测试目标** | 验证每次打开 AI 抽屉都是新会话 |
| **前置条件** | 1. 打开抽屉进行过对话<br>2. 关闭抽屉 |
| **测试步骤** | 1. 再次点击 AI 悬浮按钮打开抽屉<br>2. 观察对话区域 |
| **预期结果** | 1. 对话记录已清空<br>2. 显示初始欢迎语或空状态 |
| **优先级** | P1 |

#### TC-F202-002 验证保持打开状态下历史保留
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F202-002 |
| **测试目标** | 验证抽屉保持打开时对话历史保留 |
| **前置条件** | 抽屉已打开并有对话 |
| **测试步骤** | 1. 进行多轮对话<br>2. 不关闭抽屉，进行其他甘特图操作 |
| **预期结果** | 对话历史保持不变，不丢失 |
| **优先级** | P1 |

#### TC-F202-003 验证手动清空与自动清空逻辑互斥
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F202-003 |
| **测试目标** | 验证手动清空功能依然可用 |
| **前置条件** | 抽屉打开且有对话 |
| **测试步骤** | 1. 点击清空按钮 |
| **预期结果** | 当前会话清空，不影响下次打开（下次打开本身也是空的） |
| **优先级** | P2 |

---

### 3.15 F-203 界面交互精简

#### TC-F203-001 验证快捷指令按钮隐藏
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F203-001 |
| **测试目标** | 验证顶部工具栏不再显示多个 AI 快捷按钮 |
| **前置条件** | 应用加载完成 |
| **测试步骤** | 1. 观察顶部工具栏 |
| **预期结果** | 1. 只有"AI 设置"按钮（或合并在设置菜单中）<br>2. 原有的"润色"、"拆分"等快捷按钮不可见 |
| **优先级** | P1 |

#### TC-F203-002 验证 AI 设置入口
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F203-002 |
| **测试目标** | 验证保留 AI 设置入口且功能正常 |
| **前置条件** | 应用加载完成 |
| **测试步骤** | 1. 点击"AI 设置"按钮 |
| **预期结果** | 正常弹出 AI 设置配置弹窗 |
| **优先级** | P1 |

#### TC-F203-003 验证悬浮按钮点击进入通用助手
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F203-003 |
| **测试目标** | 验证点击悬浮按钮直接打开侧边栏 |
| **前置条件** | 悬浮按钮可见 |
| **测试步骤** | 1. 点击紫色 AI 悬浮按钮 |
| **预期结果** | 1. 打开 AI 侧边栏<br>2. 进入通用对话模式 |
| **优先级** | P1 |

---

### 3.16 F-204 悬浮按钮位置

#### TC-F204-001 验证悬浮按钮默认位置
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F204-001 |
| **测试目标** | 验证悬浮按钮不遮挡底部视图切换控件 |
| **前置条件** | 应用加载完成 |
| **测试步骤** | 1. 观察右下角悬浮按钮位置<br>2. 检查其与视图切换组件（日/周/月）的间距 |
| **预期结果** | 1. 悬浮按钮位于视图切换组件上方<br>2. 两者之间有足够间距，无重叠 |
| **优先级** | P2 |

#### TC-F204-002 验证移动端位置适配
| 项目 | 内容 |
|:-----|:-----|
| **用例编号** | TC-F204-002 |
| **测试目标** | 验证移动端悬浮按钮位置合理 |
| **前置条件** |切换到移动端视图 |
| **测试步骤** | 1. 观察悬浮按钮位置 |
| **预期结果** | 1. 位置适中，不遮挡关键操作区域<br>2. 使用 CSS `bottom` 属性调整合适 |
| **优先级** | P2 |

---

## 4. 测试数据准备

### 4.1 API 配置测试数据

| 数据项 | 值 | 用途 |
|:------:|:--:|:----:|
| 有效 API Key | `sk-test-valid-key-xxxxx` | 正常流程测试 |
| 无效 API Key | `sk-invalid-key` | 错误提示测试 |
| 有效 Base URL | `https://api.openai.com/v1` | 正常流程测试 |
| 无效 Base URL | `https://invalid.example.com` | 网络错误测试 |
| 测试模型 | `gpt-4o-mini` | 模型选择测试 |

### 4.2 模型列表测试数据

```json
[
  {
    "id": "gpt-4o",
    "name": "GPT-4o",
    "provider": "OpenAI",
    "recommended": true
  },
  {
    "id": "gpt-4o-mini",
    "name": "GPT-4o Mini",
    "provider": "OpenAI"
  },
  {
    "id": "claude-3-5-sonnet",
    "name": "Claude 3.5 Sonnet",
    "provider": "Anthropic"
  }
]
```

### 4.3 AI 响应测试数据

#### 任务润色响应

```json
{
  "type": "task_refine",
  "original": "UI优化",
  "optimized": "优化用户界面交互体验，提升可用性",
  "reasoning": "原名称过于简短，建议明确优化目标和范围"
}
```

#### 错误响应

```json
{
  "error": {
    "type": "quota_exceeded",
    "message": "You exceeded your current quota",
    "code": "insufficient_quota"
  }
}
```

### 4.4 任务测试数据

| 任务名称 | 任务概述 | 用途 |
|:--------:|:--------:|:----:|
| 短名称 | 这是一个简短的概述 | 基本功能测试 |
| 较长名称测试任务 | 这是一段较长的任务概述内容，用于测试省略显示功能。它包含足够多的字符以确保在表格列中被截断。 | 省略/悬停测试 |
| 多行概述测试 | 第一行内容\n第二行内容\n第三行内容 | 多行输入测试 |

---

## 5. 测试环境要求

### 5.1 硬件要求

| 设备类型 | 规格要求 |
|:--------:|:--------:|
| 桌面端 | 分辨率 >= 1920x1080 |
| 平板端 | iPad 或同等尺寸设备 |
| 移动端 | iPhone 12 或同等尺寸设备 |

### 5.2 软件要求

| 软件 | 版本要求 |
|:----:|:--------:|
| Chrome | >= 120 |
| Firefox | >= 120 |
| Safari | >= 17 |
| Edge | >= 120 |
| Node.js | >= 18.x |

### 5.3 测试工具

| 工具 | 用途 |
|:----:|:----:|
| Chrome DevTools | 调试、网络模拟、响应式测试 |
| Playwright | 自动化测试 |
| Lighthouse | 性能和可访问性审计 |
| NVDA/VoiceOver | 屏幕阅读器测试 |

### 5.4 网络环境

| 环境 | 说明 |
|:----:|:----:|
| 正常网络 | 延迟 < 100ms |
| 弱网环境 | 3G 模拟，延迟 300-500ms |
| 离线环境 | 无网络连接 |

### 5.5 测试账号

| 账号类型 | 用途 |
|:--------:|:----:|
| 免费账号 | 测试额度用尽场景 |
| 付费账号 | 正常功能测试 |
| 无效账号 | 认证错误测试 |

---

## 附录: 测试用例统计

| 需求编号 | P0 用例 | P1 用例 | P2 用例 | 总计 |
|:--------:|:-------:|:-------:|:-------:|:----:|
| F-101 | 4 | 2 | 2 | 8 |
| F-102 | 4 | 5 | 3 | 12 |
| F-103 | 3 | 3 | 2 | 8 |
| F-104 | 5 | 3 | 2 | 10 |
| F-105 | 5 | 4 | 1 | 10 |
| F-106 | 3 | 3 | 2 | 8 |
| F-107 | 4 | 5 | 1 | 10 |
| F-108 | 4 | 4 | 2 | 10 |
| F-109 | 3 | 2 | 3 | 8 |
| F-110 | 3 | 2 | 1 | 6 |
| F-111 | 2 | 4 | 2 | 8 |
| F-112 | 6 | 2 | 2 | 10 |
| F-201 | 2 | 2 | 0 | 4 |
| F-202 | 0 | 2 | 1 | 3 |
| F-203 | 0 | 3 | 0 | 3 |
| F-204 | 0 | 0 | 2 | 2 |
| **总计** | **48** | **48** | **24** | **120** |

---

**文档结束**

**版本历史**:

| 版本 | 日期 | 变更内容 | 作者 |
|:-----|:-----|:---------|:-----|
| v1.0 | 2026-01-18 | 初始版本，覆盖 F-101 至 F-112 全部需求 | 测试工程师 |
| v1.1 | 2026-01-18 | 增补 F-201 至 F-204 需求对应的测试用例 | 测试工程师 |
