# E2E 测试用例文档 - 批量编辑与字段管理

**测试框架**: Playwright  
**测试环境**: Chrome, Firefox, Safari  
**测试日期**: 2026-01-11  
**测试人员**: 自动化测试工程师

---

## 📋 测试概述

本文档涵盖甘特图项目管理工具的批量编辑和字段管理功能的 E2E 自动化测试用例。这些测试用例覆盖了单元测试中因 mock 依赖问题而跳过的场景，确保在真实浏览器环境中验证功能的正确性。

---

## 🎯 测试范围

### 批量编辑功能
- 批量更新不同类型字段（文本、数字、下拉选择、多选）
- 批量编辑面板的打开/关闭
- 字段选择器的动态变化
- 选中任务的管理和清除
- 错误处理和提示

### 字段管理功能
- 字段管理面板的打开/关闭
- 字段列表的渲染和显示
- 字段的新建、编辑、删除操作
- 字段类型选择器交互
- 必填字段切换
- 下拉选择和多选字段的选项配置

---

## 📊 批量编辑E2E测试用例

### TC-BE-001: 批量更新文本字段

**测试目标**: 验证批量编辑文本类型字段的完整流程

**前置条件**:
- 甘特图已加载完成
- 存在至少 3 个任务
- 至少有一个文本类型的自定义字段

**测试步骤**:
1. 点击前 3 个任务的复选框，选中任务
2. 验证选中计数显示为"3"
3. 点击"编辑模式"按钮，打开批量编辑面板
4. 验证面板显示"已选中 3 个任务"
5. 从字段下拉框选择文本类型字段
6. 在文本输入框中输入"高优先级"
7. 点击"应用到所有任务"按钮
8. 验证面板自动关闭
9. 验证选中计数归零
10. 验证显示成功提示

**预期结果**:
- ✅ 批量编辑面板正确打开
- ✅ 所有 3 个任务的字段值更新为"高优先级"
- ✅ 面板关闭后选中状态被清除
- ✅ 显示"已成功修改 3 个任务"提示

---

### TC-BE-002: 批量更新数字字段

**测试目标**: 验证批量编辑数字类型字段的功能

**前置条件**:
- 甘特图已加载完成
- 存在至少 2 个任务
- 至少有一个数字类型的自定义字段

**测试步骤**:
1. 选中前 2 个任务
2. 打开批量编辑面板
3. 选择数字类型字段
4. 在数字输入框中输入"100"
5. 应用批量编辑

**预期结果**:
- ✅ 数字输入框正确渲染（type="number"）
- ✅ 所有选中任务的数字字段更新为 100
- ✅ 显示成功提示

---

### TC-BE-003: 批量更新下拉选择字段

**测试目标**: 验证批量编辑下拉选择字段的功能

**前置条件**:
- 存在至少 3 个任务
- 至少有一个下拉选择类型的自定义字段

**测试步骤**:
1. 选中 3 个任务
2. 打开批量编辑面板
3. 选择下拉选择类型字段
4. 从下拉菜单中选择一个选项
5. 应用批量编辑

**预期结果**:
- ✅ 下拉选择框正确渲染，包含所有选项
- ✅ 所有选中任务的字段值更新为所选选项
- ✅ 面板关闭，选中状态清除

---

### TC-BE-004: 批量更新多选字段

**测试目标**: 验证批量编辑多选字段的功能

**前置条件**:
- 存在至少 2 个任务
- 至少有一个多选类型的自定义字段

**测试步骤**:
1. 选中 2 个任务
2. 打开批量编辑面板
3. 选择多选类型字段
4. 在多选下拉框中选择多个选项
5. 应用批量编辑

**预期结果**:
- ✅ 多选下拉框正确渲染（multiple 属性）
- ✅ 可以同时选择多个选项
- ✅ 所有选中任务的字段值更新为选中的选项（逗号分隔）

---

### TC-BE-005: 应用后清除选择并关闭面板

**测试目标**: 验证批量编辑应用后的状态重置

**前置条件**:
- 存在至少 3 个任务
- 至少有一个自定义字段

**测试步骤**:
1. 选中 3 个任务，验证计数显示"3"
2. 打开批量编辑面板
3. 选择任意字段并填写值
4. 点击"应用到所有任务"
5. 验证面板关闭
6. 验证选中计数归零
7. 验证所有复选框取消选中

**预期结果**:
- ✅ 批量编辑成功应用
- ✅ 面板自动关闭
- ✅ 选中任务列表清空（#selected-count = "0"）
- ✅ 甘特图中所有复选框恢复未选中状态

---

### TC-BE-006: 字段选择变化更新输入框类型

**测试目标**: 验证字段选择器变化时输入框类型的动态更新

**前置条件**:
- 至少有 4 种不同类型的自定义字段（文本、数字、下拉、多选）

**测试步骤**:
1. 选中一个任务
2. 打开批量编辑面板
3. 依次选择不同类型的字段
4. 观察输入框容器的变化

**预期结果**:
- ✅ 选择文本字段时，显示 `<input type="text">`
- ✅ 选择数字字段时，显示 `<input type="number">`
- ✅ 选择下拉选择字段时，显示 `<select>`（单选）
- ✅ 选择多选字段时，显示 `<select multiple>`
- ✅ 输入框容器在选择字段后变为可见

---

### TC-BE-007: 未选中任务时显示错误

**测试目标**: 验证未选中任务时的错误提示

**前置条件**:
- 甘特图已加载

**测试步骤**:
1. 不选中任何任务
2. 点击"编辑模式"按钮

**预期结果**:
- ✅ 批量编辑面板不打开
- ✅ 显示错误提示："请先选择要编辑的任务"
- ✅ Toast 提示类型为 error

---

### TC-BE-008: 未选择字段时显示错误

**测试目标**: 验证未选择字段时的错误提示

**前置条件**:
- 至少选中一个任务

**测试步骤**:
1. 选中任务并打开批量编辑面板
2. 不选择任何字段
3. 直接点击"应用到所有任务"

**预期结果**:
- ✅ 显示错误提示："请选择要修改的字段"
- ✅ 批量编辑不执行
- ✅ 面板保持打开状态

---

### TC-BE-009: 取消批量编辑

**测试目标**: 验证取消按钮的功能

**前置条件**:
- 已选中任务并打开批量编辑面板

**测试步骤**:
1. 选中 2 个任务
2. 打开批量编辑面板
3. 选择字段（不应用）
4. 点击"取消"按钮

**预期结果**:
- ✅ 面板关闭
- ✅ 选中状态保持（计数仍为"2"）
- ✅ 不执行批量编辑操作

---

### TC-BE-010: 通过 X 按钮关闭面板

**测试目标**: 验证 X 关闭按钮的功能

**前置条件**:
- 批量编辑面板已打开

**测试步骤**:
1. 选中任务并打开批量编辑面板
2. 点击面板右上角的"×"按钮

**预期结果**:
- ✅ 面板立即关闭
- ✅ 选中状态保持不变

---

## 🎨 字段管理 E2E 测试用例

### TC-FM-001: 打开字段管理面板

**测试目标**: 验证字段管理面板的打开功能

**前置条件**:
- 甘特图已加载完成

**测试步骤**:
1. 点击工具栏的"编辑字段"按钮
2. 观察字段管理面板

**预期结果**:
- ✅ 字段管理面板从右侧滑入
- ✅ 面板包含 "open" 类
- ✅ 字段列表容器可见

---

### TC-FM-002: 关闭字段管理面板

**测试目标**: 验证字段管理面板的关闭功能

**前置条件**:
- 字段管理面板已打开

**测试步骤**:
1. 点击面板右上角的"×"按钮

**预期结果**:
- ✅ 面板滑出并关闭
- ✅ 面板不再包含 "open" 类

---

### TC-FM-003: 渲染字段列表

**测试目标**: 验证字段列表的正确渲染

**前置条件**:
- 系统中至少有 1 个自定义字段

**测试步骤**:
1. 打开字段管理面板
2. 观察字段列表容器

**预期结果**:
- ✅ 字段列表容器可见
- ✅ 至少显示一个字段项
- ✅ 每个字段项包含字段名称、类型标签和操作按钮

---

### TC-FM-004: 显示字段类型标签

**测试目标**: 验证字段类型标签的显示

**前置条件**:
- 存在不同类型的自定义字段

**测试步骤**:
1. 打开字段管理面板
2. 检查每个字段项的类型标签

**预期结果**:
- ✅ 每个字段项显示类型标签（文本/数字/日期/下拉选择/多选）
- ✅ 类型标签文本正确
- ✅ 类型标签可见

---

### TC-FM-005: 显示必填字段标记

**测试目标**: 验证必填字段的"*"标记显示

**前置条件**:
- 存在至少一个必填字段

**测试步骤**:
1. 打开字段管理面板
2. 查找标记为必填的字段

**预期结果**:
- ✅ 必填字段名称后显示红色"*"符号
- ✅ 非必填字段不显示"*"符号

---

### TC-FM-006: 打开新建字段弹窗

**测试目标**: 验证新建字段弹窗的打开

**前置条件**:
- 字段管理面板已打开

**测试步骤**:
1. 点击"+ 新增字段"按钮
2. 观察字段配置弹窗

**预期结果**:
- ✅ 字段配置弹窗显示（display: flex）
- ✅ 弹窗标题为"字段配置"
- ✅ 所有输入框为空白状态
- ✅ 默认字段类型为"文本"

---

### TC-FM-007: 创建新字段

**测试目标**: 验证创建新字段的完整流程

**前置条件**:
- 字段配置弹窗已打开

**测试步骤**:
1. 在字段名称输入框填写"测试字段E2E"
2. 点击字段类型选择器，选择"文本"
3. 在默认值输入框填写"默认值"
4. 点击"保存"按钮
5. 观察结果

**预期结果**:
- ✅ 弹窗关闭
- ✅ 显示成功提示："字段创建成功"
- ✅ 新字段出现在字段列表中
- ✅ 字段名称为"测试字段E2E"

---

### TC-FM-008: 编辑现有字段

**测试目标**: 验证编辑现有字段的功能

**前置条件**:
- 至少存在一个自定义字段

**测试步骤**:
1. 打开字段管理面板
2. 点击某个字段的"✏️"编辑按钮
3. 修改字段名称（追加"_已修改"）
4. 点击"保存"按钮

**预期结果**:
- ✅ 字段配置弹窗打开，字段信息已填充
- ✅ 保存后显示成功提示："字段更新成功"
- ✅ 字段列表中字段名称已更新

---

### TC-FM-009: 删除字段

**测试目标**: 验证删除字段的功能

**前置条件**:
- 存在至少一个可删除的自定义字段

**测试步骤**:
1. 创建一个测试字段"待删除字段E2E"
2. 在字段列表中找到该字段
3. 点击"🗑️"删除按钮
4. 在确认对话框中点击"确定"

**预期结果**:
- ✅ 显示确认对话框："确定要删除字段..."
- ✅ 确认后字段从列表中移除
- ✅ 显示成功提示："字段删除成功"

---

### TC-FM-010: 字段类型选择器交互

**测试目标**: 验证字段类型选择器的完整交互流程

**前置条件**:
- 字段配置弹窗已打开

**测试步骤**:
1. 点击字段类型选择器
2. 依次选择所有字段类型（文本、数字、日期、下拉选择、多选）
3. 观察选择器显示和隐藏select元素的值

**预期结果**:
- ✅ 点击选择器显示下拉菜单
- ✅ 每次选择后选择器显示更新为对应类型名称
- ✅ 隐藏的 `<select id="field-type">` 值正确更新
- ✅ 当前选中项显示"✓"标记

---

### TC-FM-011: 下拉和多选字段的选项配置

**测试目标**: 验证选项配置区域的显示/隐藏逻辑

**前置条件**:
- 字段配置弹窗已打开

**测试步骤**:
1. 选择"下拉选择"类型，观察选项配置
2. 选择"多选"类型，观察选项配置
3. 选择"文本"类型，观察选项配置

**预期结果**:
- ✅ 选择"下拉选择"时，选项配置区域显示（display: block）
- ✅ 选择"多选"时，选项配置区域保持显示
- ✅ 选择"文本"/"数字"/"日期"时，选项配置区域隐藏（display: none）
- ✅ "添加选项"按钮在显示时可见

---

### TC-FM-012: 必填字段切换

**测试目标**: 验证必填字段切换功能

**前置条件**:
- 字段配置弹窗已打开

**测试步骤**:
1. 点击必填字段切换行
2. 再次点击取消选中

**预期结果**:
- ✅ 第一次点击：切换变为激活状态，隐藏checkbox被选中
- ✅ 第二次点击：切换变为非激活状态，checkbox取消选中
- ✅ 切换状态与checkbox状态保持同步

---

### TC-FM-013: 取消创建字段

**测试目标**: 验证取消按钮的功能

**前置条件**:
- 字段配置弹窗已打开

**测试步骤**:
1. 填写字段名称"不保存的字段"
2. 点击"取消"按钮
3. 检查字段列表

**预期结果**:
- ✅ 弹窗关闭
- ✅ 字段未被创建，不出现在字段列表中

---

### TC-FM-014: 通过 X 关闭弹窗

**测试目标**: 验证 X 关闭按钮的功能

**前置条件**:
- 字段配置弹窗已打开

**测试步骤**:
1. 点击弹窗右上角的"×"按钮

**预期结果**:
-  弹窗关闭（display: none）
- ✅ 未保存的更改丢弃

---

## 📈 测试执行统计

### 批量编辑测试
| 测试用例 | 状态 | 执行时间 |
|:--------:|:----:|:--------:|
| TC-BE-001 | ⏸️ 待执行 | - |
| TC-BE-002 | ⏸️ 待执行 | - |
| TC-BE-003 | ⏸️ 待执行 | - |
| TC-BE-004 | ⏸️ 待执行 | - |
| TC-BE-005 | ⏸️ 待执行 | - |
| TC-BE-006 | ⏸️ 待执行 | - |
| TC-BE-007 | ⏸️ 待执行 | - |
| TC-BE-008 | ⏸️ 待执行 | - |
| TC-BE-009 | ⏸️ 待执行 | - |
| TC-BE-010 | ⏸️ 待执行 | - |

### 字段管理测试
| 测试用例 | 状态 | 执行时间 |
|:--------:|:----:|:--------:|
| TC-FM-001 | ⏸️ 待执行 | - |
| TC-FM-002 | ⏸️ 待执行 | - |
| TC-FM-003 | ⏸️ 待执行 | - |
| TC-FM-004 | ⏸️ 待执行 | - |
| TC-FM-005 | ⏸️ 待执行 | - |
| TC-FM-006 | ⏸️ 待执行 | - |
| TC-FM-007 | ⏸️ 待执行 | - |
| TC-FM-008 | ⏸️ 待执行 | - |
| TC-FM-009 | ⏸️ 待执行 | - |
| TC-FM-010 | ⏸️ 待执行 | - |
| TC-FM-011 | ⏸️ 待执行 | - |
| TC-FM-012 | ⏸️ 待执行 | - |
| TC-FM-013 | ⏸️ 待执行 | - |
| TC-FM-014 | ⏸️ 待执行 | - |

---

## 🔄 测试执行命令

```bash
# 运行所有 E2E 测试
npx playwright test tests/e2e/

# 运行批量编辑测试
npx playwright test tests/e2e/batch-edit.spec.js

# 运行字段管理测试
npx playwright test tests/e2e/field-management.spec.js

# 生成HTML报告
npx playwright show-report

# 调试模式运行
npx playwright test --debug tests/e2e/batch-edit.spec.js

# 在特定浏览器运行
npx playwright test --project=chromium tests/e2e/
npx playwright test --project=firefox tests/e2e/
```

---

## ✅ 测试覆盖映射

| 跳过的单元测试 | 对应的 E2E 测试用例 |
|:------------:|:------------------:|
| 批量更新文本字段 | TC-BE-001 |
| 批量更新数字字段 | TC-BE-002 |
| 批量更新下拉选择字段 | TC-BE-003 |
| 批量更新多选字段 | TC-BE-004 |
| 应用后清除选择并关闭面板 | TC-BE-005 |

---

## 🎯 测试完成标准

- [x] 所有 24 个测试用例已编写完成
- [ ] 所有测试用例在 Chrome 中通过
- [ ] 所有测试用例在 Firefox 中通过  
- [ ] 测试覆盖率达到 100%（针对跳过的单元测试）
- [ ] 无阻塞性缺陷

---

**文档编写日期**: 2026-01-11  
**文档版本**: v1.0  
**编写人员**: AI 自动化测试工程师
