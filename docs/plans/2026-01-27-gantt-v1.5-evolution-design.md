# ç”˜ç‰¹å›¾ç¼–è¾‘å™¨ v1.5 è¿›é˜¶åŠŸèƒ½è®¾è®¡

## æ¦‚è¿°

åœ¨ v1.0 å»ºç«‹æ ¸å¿ƒè°ƒåº¦èƒ½åŠ›ä¸ç¨³å®šæ€§çš„åŸºç¡€ä¸Š,å¼•å…¥**ä¸“ä¸šçº§è¾…åŠ©**åŠŸèƒ½,å°†äº§å“ä»"å¯ç”¨"å‡çº§ä¸º"ä¸“ä¸š"ã€‚

## éœ€æ±‚å†³ç­–æ€»ç»“

### åŠŸèƒ½èŒƒå›´

| åŠŸèƒ½ | æœ€ç»ˆèŒƒå›´ | ä¼˜å…ˆçº§ | å®ç°å¤æ‚åº¦ |
|------|---------|--------|-----------|
| **Baseline** | å•æ¬¡é‡Œç¨‹ç¢‘å¯¹æ¯”ï¼ˆä¿å­˜åˆå§‹è®¡åˆ’,æ˜¾ç¤ºåå·®ï¼‰ | P1 | ğŸŸ¢ ä½ |
| **Export** | å®Œæ•´é•¿å›¾å¯¼å‡ºï¼ˆPNG,ç”¨äºå½’æ¡£ï¼‰ | P1 | ğŸŸ¡ ä¸­ |
| **Resource** | è½»é‡å†²çªæ£€æµ‹ï¼ˆæŒ‰å·¥æ—¶ç´¯åŠ ,è¶…è½½æç¤ºï¼‰ | P2 | ğŸŸ¢ ä½ |
| **Time Display** | æ”¯æŒå°æ•°å¤© + æœ¬åœ°åŒ–äººæ€§åŒ–æ˜¾ç¤º | P2 | ğŸŸ¢ ä½ |
| **Smart Snapping** | æµ‹è¯• DHTMLX é»˜è®¤è¡Œä¸º,å¯èƒ½ä¸éœ€è¦å¼€å‘ | P3 | ğŸŸ¢ æä½/æ—  |

### æ ¸å¿ƒå†³ç­–

1. **Baseline**: å•æ¬¡åŸºçº¿,å¯è¦†ç›–,æ— éœ€å¤šç‰ˆæœ¬ç®¡ç†
2. **Export**: é•¿å›¾æ‹¼æ¥æ–¹æ¡ˆ,æ”¯æŒå½’æ¡£éœ€æ±‚
3. **Resource**: æŒ‰ 8 å°æ—¶/å¤©è®¡ç®—å·¥æ—¶,è¶…è½½é«˜äº®æç¤º
4. **Time Display**: ä¿æŒ `duration_unit = "day"`,é€šè¿‡æ ¼å¼åŒ–å‡½æ•°å®ç°å°æ—¶çº§æ˜¾ç¤º
5. **Smart Snapping**: å…ˆéªŒè¯ DHTMLX é»˜è®¤é…ç½®,ä¸æ»¡è¶³å†å¢å¼º

---

## æ•´ä½“æ¶æ„è®¾è®¡

### æ¨¡å—ç»„ç»‡

```
src/features/
â”œâ”€â”€ gantt/
â”‚   â”œâ”€â”€ baseline.js          # æ–°å¢ï¼šåŸºçº¿ç®¡ç†
â”‚   â”œâ”€â”€ export-image.js      # æ–°å¢ï¼šé•¿å›¾å¯¼å‡º
â”‚   â”œâ”€â”€ resource-conflict.js # æ–°å¢ï¼šèµ„æºå†²çªæ£€æµ‹
â”‚   â”œâ”€â”€ time-display.js      # æ–°å¢ï¼šæ—¶é—´äººæ€§åŒ–æ˜¾ç¤º
â”‚   â””â”€â”€ init.js              # ä¿®æ”¹ï¼šé›†æˆæ–°åŠŸèƒ½
â”œâ”€â”€ toolbar/
â”‚   â””â”€â”€ index.js             # ä¿®æ”¹ï¼šæ·»åŠ  Baseline å’Œ Export æŒ‰é’®
â””â”€â”€ utils/
    â””â”€â”€ time-formatter.js    # æ–°å¢ï¼šæ—¶é•¿æ ¼å¼åŒ–å·¥å…·
```

### æ•°æ®å­˜å‚¨ç­–ç•¥

| æ•°æ®ç±»å‹ | å­˜å‚¨ä½ç½® | ç†ç”± |
|---------|---------|------|
| **Baseline å¿«ç…§** | IndexedDB (æ–°è¡¨ `baselines`) | åŒ…å«å®Œæ•´ä»»åŠ¡æ ‘,æ•°æ®é‡å¤§ |
| **Baseline å¼€å…³çŠ¶æ€** | localStorage | UI çŠ¶æ€,å¿«é€Ÿè¯»å– |
| **èµ„æºå†²çªç¼“å­˜** | å†…å­˜ï¼ˆå®æ—¶è®¡ç®—ï¼‰ | åŠ¨æ€æ•°æ®,æ¯æ¬¡ä»»åŠ¡å˜æ›´åé‡ç®— |

### æ–°å¢ä¾èµ–

```json
{
  "dependencies": {
    "html2canvas": "^1.4.1"
  }
}
```

---

## åŠŸèƒ½è¯¦ç»†è®¾è®¡

### 1. é¡¹ç›®åŸºçº¿ (Baseline)

#### æ•°æ®ç»“æ„

**IndexedDB è¡¨ç»“æ„ï¼š**
```javascript
// baselineStore
{
  id: "baseline_2026-01-27",  // ä¸»é”®ï¼šå›ºå®šå‰ç¼€ + ä¿å­˜æ—¥æœŸ
  savedAt: "2026-01-27T10:30:00Z",  // ä¿å­˜æ—¶é—´æˆ³
  snapshot: {
    data: [...],  // å®Œæ•´çš„ä»»åŠ¡æ•°ç»„ï¼ˆåŒ…å« start_date, end_date, durationï¼‰
    links: [...]  // ä¾èµ–å…³ç³»å¿«ç…§
  }
}
```

**ä»»åŠ¡å¯¹è±¡æ‰©å±•ï¼š**
```javascript
task.baseline_start = "2026-01-15";  // åŸºçº¿å¼€å§‹æ—¥æœŸ
task.baseline_end = "2026-01-20";    // åŸºçº¿ç»“æŸæ—¥æœŸ
task.baseline_duration = 5;          // åŸºçº¿å·¥æœŸ
```

#### UI äº¤äº’æµç¨‹

**å·¥å…·æ æŒ‰é’®ï¼š**
```html
<button id="save-baseline-btn">ä¿å­˜åŸºçº¿</button>
<label class="toggle-switch">
  æ˜¾ç¤ºåŸºçº¿
  <input type="checkbox" id="show-baseline-toggle">
</label>
```

**æ“ä½œæµç¨‹ï¼š**
1. ç”¨æˆ·ç‚¹å‡»"ä¿å­˜åŸºçº¿"
   - å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ï¼š"ç¡®å®šä¿å­˜å½“å‰é¡¹ç›®çŠ¶æ€ä¸ºåŸºçº¿ï¼Ÿä¹‹å‰çš„åŸºçº¿å°†è¢«è¦†ç›–"
   - ç¡®è®¤åï¼šè¯»å– `gantt.serialize()`,å­˜å…¥ IndexedDB
   - Toast æç¤ºï¼š"åŸºçº¿å·²ä¿å­˜ï¼ˆ2026-01-27 10:30ï¼‰"

2. ç”¨æˆ·åˆ‡æ¢"æ˜¾ç¤ºåŸºçº¿"å¼€å…³
   - å¼€å¯ï¼šä» IndexedDB è¯»å– baseline,å°†æ•°æ®åˆå¹¶åˆ°ä»»åŠ¡å¯¹è±¡çš„ `baseline_*` å­—æ®µ
   - è°ƒç”¨ `gantt.addTaskLayer()` æ¸²æŸ“ç°è‰²åŸºçº¿æ¡
   - å…³é—­ï¼šç§»é™¤ TaskLayer

#### æ¸²æŸ“å®ç°

```javascript
// src/features/gantt/baseline.js
export function initBaseline() {
  gantt.addTaskLayer({
    renderer: {
      render: function(task) {
        if (!task.baseline_start || !task.baseline_end) return false;
        if (!localStorage.getItem('show_baseline')) return false;

        const sizes = gantt.getTaskPosition(
          task,
          new Date(task.baseline_start),
          new Date(task.baseline_end)
        );

        const el = document.createElement('div');
        el.className = 'baseline-bar';
        el.style.left = sizes.left + 'px';
        el.style.width = sizes.width + 'px';
        el.style.height = '8px';
        el.style.top = '28px';

        return el;
      },
      getRectangle: function(task) {
        return gantt.getTaskPosition(
          task,
          new Date(task.baseline_start),
          new Date(task.baseline_end)
        );
      }
    }
  });
}
```

**CSS æ ·å¼ï¼š**
```css
.baseline-bar {
  background: #9ca3af;
  opacity: 0.6;
  border-radius: 4px;
  pointer-events: none;
}
```

#### åå·®è®¡ç®—

```javascript
// Tooltip æ˜¾ç¤ºåå·®
gantt.templates.tooltip_text = function(start, end, task) {
  let html = `<b>${task.text}</b><br/>`;

  if (task.baseline_end && localStorage.getItem('show_baseline')) {
    const actualEnd = new Date(task.end_date);
    const baselineEnd = new Date(task.baseline_end);
    const diffDays = (actualEnd - baselineEnd) / (1000 * 60 * 60 * 24);

    if (diffDays > 0) {
      html += `<br/>âš ï¸ å»¶è¿Ÿ ${formatDuration(diffDays)}`;
    } else if (diffDays < 0) {
      html += `<br/>âœ… æå‰ ${formatDuration(Math.abs(diffDays))}`;
    }
  }

  return html;
};
```

---

### 2. é«˜çº§å¯¼å‡º (Export)

#### æŠ€æœ¯æ–¹æ¡ˆ

**é€‰æ‹© html2canvasï¼š**
- âœ… æ”¯æŒ Canvas å…ƒç´ æˆªå›¾
- âœ… æ”¯æŒå¤æ‚æ ·å¼æ¸²æŸ“
- âš ï¸ éœ€è¦è‡ªè¡Œå®ç°é•¿å›¾æ‹¼æ¥

#### é•¿å›¾æ‹¼æ¥ç®—æ³•

```javascript
// src/features/gantt/export-image.js
export async function exportFullGantt() {
  const container = document.querySelector('.gantt_task');
  const viewportHeight = container.clientHeight;
  const totalHeight = container.scrollHeight;
  const totalWidth = container.scrollWidth;

  // ä¸´æ—¶ç¦ç”¨ smart_rendering
  const originalSmartRendering = gantt.config.smart_rendering;
  gantt.config.smart_rendering = false;
  gantt.render();

  // æ˜¾ç¤ºè¿›åº¦æç¤º
  showProgress('æ­£åœ¨ç”Ÿæˆå›¾ç‰‡ï¼Œè¯·ç¨å€™...');

  // åˆ†å—æˆªå›¾
  const chunks = Math.ceil(totalHeight / viewportHeight);
  const canvasList = [];

  for (let i = 0; i < chunks; i++) {
    container.scrollTop = i * viewportHeight;

    updateProgress(`æ­£åœ¨æˆªå›¾ï¼š${i + 1} / ${chunks}`);

    // ç­‰å¾… Canvas é‡ç»˜
    await new Promise(resolve => setTimeout(resolve, 300));

    const canvas = await html2canvas(container, {
      scrollY: -window.scrollY,
      scrollX: -window.scrollX,
      windowWidth: totalWidth,
      windowHeight: viewportHeight
    });

    canvasList.push(canvas);
  }

  // æ‹¼æ¥æ‰€æœ‰ Canvas
  const finalCanvas = document.createElement('canvas');
  finalCanvas.width = totalWidth;
  finalCanvas.height = totalHeight;
  const ctx = finalCanvas.getContext('2d');

  canvasList.forEach((canvas, index) => {
    ctx.drawImage(canvas, 0, index * viewportHeight);
  });

  // æ¢å¤é…ç½®
  gantt.config.smart_rendering = originalSmartRendering;
  container.scrollTop = 0;
  gantt.render();

  // ä¸‹è½½
  const link = document.createElement('a');
  link.download = `gantt-${new Date().toISOString().slice(0,10)}.png`;
  link.href = finalCanvas.toDataURL('image/png');
  link.click();

  hideProgress();
  showToast(i18n.t('export.success'));
}
```

#### UI äº¤äº’

**å·¥å…·æ æŒ‰é’®ï¼š**
```html
<div class="dropdown">
  <button id="export-btn">å¯¼å‡ºå›¾ç‰‡ â–¼</button>
  <div class="dropdown-menu">
    <button id="export-current-view">å¯¼å‡ºå½“å‰è§†å›¾</button>
    <button id="export-full-gantt">å¯¼å‡ºå®Œæ•´ç”˜ç‰¹å›¾ï¼ˆé•¿å›¾ï¼‰</button>
  </div>
</div>
```

#### æ€§èƒ½ä¼˜åŒ–

1. **ç¦ç”¨ smart_rendering**ï¼šå¯¼å‡ºå‰ä¸´æ—¶ç¦ç”¨ï¼Œé¿å…è§†å£å¤–ä»»åŠ¡ä¸æ¸²æŸ“
2. **è¿›åº¦åé¦ˆ**ï¼šæ˜¾ç¤ºè¿›åº¦æ¡ï¼Œé¿å…ç”¨æˆ·ä»¥ä¸ºå¡æ­»
3. **Canvas æ¸…ç†**ï¼šå¯¼å‡ºå®Œæˆåé‡Šæ”¾ä¸´æ—¶ Canvas å†…å­˜

---

### 3. èµ„æºå†²çªæ£€æµ‹ (Resource Conflict)

#### å†²çªæ£€æµ‹ç®—æ³•

**æ ¸å¿ƒæ€è·¯ï¼š** æŒ‰å·¥æ—¶ç´¯åŠ ï¼Œè€Œéç®€å•è®¡æ•°

```javascript
// src/features/gantt/resource-conflict.js
export function detectResourceConflicts() {
  const assigneeKey = getAssigneeFieldKey();
  const tasks = gantt.getTaskByTime();

  // æ—¥æœŸ -> è´Ÿè´£äºº -> å·¥æ—¶ä¿¡æ¯
  const dailyWorkload = {};

  tasks.forEach(task => {
    if (task.type === 'project') return;

    const assignee = task[assigneeKey];
    if (!assignee) return;

    const workDays = getWorkDays(task.start_date, task.end_date);
    const duration = task.duration;

    // è®¡ç®—æ¯å¤©åˆ†é…çš„å·¥æ—¶
    let hoursPerDay;

    if (duration < 1) {
      // å°æ—¶çº§ä»»åŠ¡ï¼šç›´æ¥æŒ‰å®é™…å°æ—¶
      hoursPerDay = duration * 8;
    } else if (workDays.length === 1) {
      // å•å¤©ä»»åŠ¡ï¼šæœ€å¤š 8 å°æ—¶
      hoursPerDay = Math.min(duration * 8, 8);
    } else {
      // å¤šå¤©ä»»åŠ¡ï¼šæ¯å¤© 8 å°æ—¶
      hoursPerDay = 8;
    }

    workDays.forEach(day => {
      const dateKey = gantt.date.date_to_str('%Y-%m-%d')(day);

      if (!dailyWorkload[dateKey]) {
        dailyWorkload[dateKey] = {};
      }

      if (!dailyWorkload[dateKey][assignee]) {
        dailyWorkload[dateKey][assignee] = {
          totalHours: 0,
          tasks: []
        };
      }

      dailyWorkload[dateKey][assignee].totalHours += hoursPerDay;
      dailyWorkload[dateKey][assignee].tasks.push({
        id: task.id,
        text: task.text,
        hours: hoursPerDay
      });
    });
  });

  // æ ‡è®°è¶…è½½ä»»åŠ¡ï¼ˆè¶…è¿‡ 8 å°æ—¶ï¼‰
  const conflictTaskIds = new Set();
  const conflictDetails = {};

  Object.entries(dailyWorkload).forEach(([date, assignments]) => {
    Object.entries(assignments).forEach(([assignee, workload]) => {
      if (workload.totalHours > 8) {
        const overload = workload.totalHours - 8;

        workload.tasks.forEach(task => {
          conflictTaskIds.add(task.id);

          if (!conflictDetails[task.id]) {
            conflictDetails[task.id] = [];
          }

          conflictDetails[task.id].push({
            date,
            assignee,
            totalHours: workload.totalHours,
            overload
          });
        });
      }
    });
  });

  return { conflictTaskIds, conflictDetails };
}

// è·å–ä»»åŠ¡è¦†ç›–çš„æ‰€æœ‰å·¥ä½œæ—¥
function getWorkDays(startDate, endDate) {
  const days = [];
  let current = new Date(startDate);

  while (current <= endDate) {
    if (gantt.isWorkTime(current)) {
      days.push(new Date(current));
    }
    current.setDate(current.getDate() + 1);
  }

  return days;
}
```

#### è§†è§‰åé¦ˆ

**ä»»åŠ¡æ¡æ ·å¼ï¼š**
```javascript
gantt.templates.task_class = function(start, end, task) {
  const classes = [];

  if (conflictTaskIds.has(task.id)) {
    classes.push('resource-conflict');
  }

  // ... å…¶ä»– class

  return classes.join(' ');
};
```

```css
.resource-conflict .gantt_task_content {
  border: 2px solid #f59e0b;
  box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
}
```

**Tooltip å¢å¼ºï¼š**
```javascript
gantt.templates.tooltip_text = function(start, end, task) {
  let html = `<b>${task.text}</b><br/>`;
  html += `æ—¶é•¿: ${formatDuration(task.duration)}<br/>`;

  if (conflictTaskIds.has(task.id)) {
    const conflicts = conflictDetails[task.id];
    const worstDay = conflicts.reduce((max, c) =>
      c.overload > max.overload ? c : max
    );

    html += `<div style="color: #f59e0b; margin-top: 8px; border-top: 1px solid #fcd34d; padding-top: 8px;">`;
    html += `âš ï¸ èµ„æºè¶…è½½<br/>`;
    html += `${worstDay.assignee} åœ¨ ${worstDay.date} çš„å·¥ä½œé‡ä¸º ${worstDay.totalHours.toFixed(1)} å°æ—¶<br/>`;
    html += `è¶…è½½ ${worstDay.overload.toFixed(1)} å°æ—¶`;
    html += `</div>`;
  }

  return html;
};
```

#### è§¦å‘æ—¶æœº

```javascript
// é˜²æŠ–å¤„ç†
let detectTimer = null;

function scheduleConflictDetection() {
  clearTimeout(detectTimer);
  detectTimer = setTimeout(() => {
    const result = detectResourceConflicts();
    conflictTaskIds = result.conflictTaskIds;
    conflictDetails = result.conflictDetails;
    gantt.render();
  }, 500);
}

gantt.attachEvent('onAfterTaskUpdate', scheduleConflictDetection);
gantt.attachEvent('onAfterTaskAdd', scheduleConflictDetection);
gantt.attachEvent('onAfterTaskDelete', scheduleConflictDetection);
```

---

### 4. æ—¶é—´é¢—ç²’åº¦ä¼˜åŒ– (Time Display)

#### ç­–ç•¥

- ä¿æŒ `duration_unit = "day"`
- é€šè¿‡æ ¼å¼åŒ–å‡½æ•°å®ç°äººæ€§åŒ–æ˜¾ç¤º
- æ”¯æŒ 4 ç§è¯­è¨€çš„æœ¬åœ°åŒ–

#### æ ¼å¼åŒ–å‡½æ•°

```javascript
// src/utils/time-formatter.js
import i18n from '../i18n/index.js';

export function formatDuration(days, options = {}) {
  const { showZero = false } = options;

  if (days === 0 && !showZero) {
    return i18n.t('duration.format.hoursOnly').replace('{hours}', '0');
  }

  const fullDays = Math.floor(days);
  const remainingHours = Math.round((days - fullDays) * 8);

  // åªæœ‰å¤©æ•°
  if (fullDays > 0 && remainingHours === 0) {
    return i18n.t('duration.format.daysOnly').replace('{days}', fullDays);
  }

  // åªæœ‰å°æ—¶
  if (fullDays === 0 && remainingHours > 0) {
    return i18n.t('duration.format.hoursOnly').replace('{hours}', remainingHours);
  }

  // å¤© + å°æ—¶
  if (fullDays > 0 && remainingHours > 0) {
    return i18n.t('duration.format.full')
      .replace('{days}', fullDays)
      .replace('{hours}', remainingHours);
  }

  return i18n.t('duration.format.hoursOnly').replace('{hours}', '0');
}

export function parseDurationInput(input) {
  const locale = i18n.getCurrentLocale();

  const patterns = {
    'zh-CN': { day: /(\d+\.?\d*)\s*å¤©/, hour: /(\d+\.?\d*)\s*å°æ—¶/ },
    'en-US': { day: /(\d+\.?\d*)\s*d/, hour: /(\d+\.?\d*)\s*h/ },
    'ja-JP': { day: /(\d+\.?\d*)\s*æ—¥/, hour: /(\d+\.?\d*)\s*æ™‚é–“/ },
    'ko-KR': { day: /(\d+\.?\d*)\s*ì¼/, hour: /(\d+\.?\d*)\s*ì‹œê°„/ }
  };

  const pattern = patterns[locale] || patterns['en-US'];

  let days = 0;
  const dayMatch = input.match(pattern.day);
  const hourMatch = input.match(pattern.hour);

  if (dayMatch) days += parseFloat(dayMatch[1]);
  if (hourMatch) days += parseFloat(hourMatch[1]) / 8;

  if (!dayMatch && !hourMatch) {
    const num = parseFloat(input);
    if (!isNaN(num)) days = num;
  }

  return days;
}
```

#### æœ¬åœ°åŒ–é…ç½®

```javascript
// zh-CN
duration: {
  format: {
    full: '{days} å¤© {hours} å°æ—¶',
    daysOnly: '{days} å¤©',
    hoursOnly: '{hours} å°æ—¶'
  }
}

// en-US
duration: {
  format: {
    full: '{days}d {hours}h',
    daysOnly: '{days}d',
    hoursOnly: '{hours}h'
  }
}

// ja-JP
duration: {
  format: {
    full: '{days}æ—¥ {hours}æ™‚é–“',
    daysOnly: '{days}æ—¥',
    hoursOnly: '{hours}æ™‚é–“'
  }
}

// ko-KR
duration: {
  format: {
    full: '{days}ì¼ {hours}ì‹œê°„',
    daysOnly: '{days}ì¼',
    hoursOnly: '{hours}ì‹œê°„'
  }
}
```

#### åº”ç”¨ä½ç½®

1. **Grid åˆ—æ˜¾ç¤º**
```javascript
{
  name: 'duration',
  template: (task) => formatDuration(task.duration)
}
```

2. **Tooltip æ˜¾ç¤º**
```javascript
gantt.templates.tooltip_text = function(start, end, task) {
  return `æ—¶é•¿: ${formatDuration(task.duration)}`;
};
```

3. **ä»»åŠ¡è¯¦æƒ…é¢æ¿**
```html
<input type="number" step="0.125" value="${task.duration}">
<span class="duration-hint">${formatDuration(task.duration)}</span>
```

4. **å°ä»»åŠ¡æœ€å°å®½åº¦**
```css
.gantt_task_content {
  min-width: 20px;
}

.short-task .gantt_task_content {
  border: 2px solid currentColor;
}
```

```javascript
gantt.templates.task_class = function(start, end, task) {
  if (task.duration < 0.5) return 'short-task';
  return '';
};
```

---

### 5. Smart Snapping æµ‹è¯•æ–¹æ¡ˆ

#### éªŒè¯æ­¥éª¤

1. **å¯ç”¨é»˜è®¤é…ç½®**
```javascript
gantt.config.round_dnd_dates = true;
gantt.config.duration_step = 1;
```

2. **æ‰‹åŠ¨æµ‹è¯•åœºæ™¯**

| åœºæ™¯ | æ“ä½œ | é¢„æœŸè¡Œä¸º |
|------|------|---------|
| ç½‘æ ¼å¸é™„ | æ‹–æ‹½ä»»åŠ¡åˆ° 10:30 ä½ç½® | è‡ªåŠ¨å¸é™„åˆ° 00:00 |
| å°æ—¶ä»»åŠ¡ | æ‹–æ‹½ 0.25 å¤©ä»»åŠ¡ | å¸é™„åˆ° 0.125 çš„å€æ•° |
| ä¾èµ–è¿çº¿ | æ‹–å‡ºè¿çº¿é è¿‘ä»»åŠ¡ | è‡ªåŠ¨å¸é™„åˆ°èµ·ç‚¹/ç»ˆç‚¹ |

3. **å†³ç­–æ ‡å‡†**

| æƒ…å†µ | å†³ç­– |
|------|------|
| é»˜è®¤è¡Œä¸ºæ»¡è¶³éœ€æ±‚ | âœ… æ— éœ€å¼€å‘ |
| å¸é™„ä¸å¤Ÿæ˜æ˜¾ | âš ï¸ æ·»åŠ è§†è§‰è¾…åŠ©çº¿ï¼ˆ10-20 è¡Œï¼‰ |
| è¿çº¿ç»å¸¸å‡ºé”™ | âš ï¸ æ‰©å¤§ç£å¸èŒƒå›´ |

---

## éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `src/features/gantt/baseline.js` | æ–°å¢ï¼šåŸºçº¿ä¿å­˜ã€åŠ è½½ã€æ¸²æŸ“ |
| `src/features/gantt/export-image.js` | æ–°å¢ï¼šé•¿å›¾å¯¼å‡ºé€»è¾‘ |
| `src/features/gantt/resource-conflict.js` | æ–°å¢ï¼šèµ„æºå†²çªæ£€æµ‹ç®—æ³• |
| `src/utils/time-formatter.js` | æ–°å¢ï¼šæ—¶é•¿æ ¼å¼åŒ–å·¥å…· |
| `src/features/gantt/init.js` | ä¿®æ”¹ï¼šé›†æˆ baseline layerã€å†²çªæ£€æµ‹ |
| `src/features/gantt/templates.js` | ä¿®æ”¹ï¼šTooltip æ˜¾ç¤ºåå·®ã€å†²çªã€æ—¶é•¿ |
| `src/features/gantt/columns.js` | ä¿®æ”¹ï¼šduration åˆ—ä½¿ç”¨ formatDuration |
| `src/features/task-details/right-section.js` | ä¿®æ”¹ï¼šå·¥æœŸè¾“å…¥æ”¯æŒå°æ—¶ã€å®æ—¶æç¤º |
| `src/features/toolbar/index.js` | ä¿®æ”¹ï¼šæ·»åŠ åŸºçº¿ã€å¯¼å‡ºæŒ‰é’® |
| `src/core/store.js` | ä¿®æ”¹ï¼šæ·»åŠ  baseline ç›¸å…³ IndexedDB æ“ä½œ |
| `src/i18n/locales/zh-CN.js` | æ–°å¢ï¼šbaselineã€exportã€duration ç›¸å…³ç¿»è¯‘ |
| `src/i18n/locales/en-US.js` | æ–°å¢ï¼šbaselineã€exportã€duration ç›¸å…³ç¿»è¯‘ |
| `src/i18n/locales/ja-JP.js` | æ–°å¢ï¼šbaselineã€exportã€duration ç›¸å…³ç¿»è¯‘ |
| `src/i18n/locales/ko-KR.js` | æ–°å¢ï¼šbaselineã€exportã€duration ç›¸å…³ç¿»è¯‘ |
| `package.json` | ä¿®æ”¹ï¼šæ·»åŠ  html2canvas ä¾èµ– |

---

## æµ‹è¯•éªŒæ”¶

### åŠŸèƒ½æµ‹è¯•

#### Baseline
- [ ] ä¿å­˜åŸºçº¿ï¼šè¦†ç›–ç¡®è®¤ã€Toast æç¤º
- [ ] æ˜¾ç¤ºåŸºçº¿ï¼šç°è‰²æ¡æ­£ç¡®æ¸²æŸ“ã€ä½ç½®å‡†ç¡®
- [ ] åå·®è®¡ç®—ï¼šTooltip æ˜¾ç¤ºå»¶è¿Ÿ/æå‰ã€æ”¯æŒå°æ—¶çº§
- [ ] åˆ·æ–°é¡µé¢ååŸºçº¿ä¾ç„¶æ˜¾ç¤º
- [ ] ä¿®æ”¹ä»»åŠ¡ååå·®å®æ—¶æ›´æ–°

#### Export
- [ ] å¯¼å‡ºå½“å‰è§†å›¾ï¼šå¿«é€Ÿæˆªå›¾æˆåŠŸ
- [ ] å¯¼å‡ºå®Œæ•´ç”˜ç‰¹å›¾ï¼šé•¿å›¾æ‹¼æ¥æ— æ¥ç¼
- [ ] è¿›åº¦æç¤ºï¼šæ˜¾ç¤ºè¿›åº¦ç™¾åˆ†æ¯”
- [ ] æ–‡ä»¶å‘½åï¼šåŒ…å«æ—¥æœŸ `gantt-2026-01-27.png`
- [ ] 1000+ ä»»åŠ¡ï¼šå¯¼å‡ºä¸å¡æ­»ã€å›¾ç‰‡å®Œæ•´

#### Resource Conflict
- [ ] å·¥æ—¶è®¡ç®—ï¼š0.25 å¤©ä»»åŠ¡ = 2 å°æ—¶
- [ ] å†²çªæ£€æµ‹ï¼šåŒä¸€å¤© >8 å°æ—¶é«˜äº®
- [ ] Tooltip æç¤ºï¼šæ˜¾ç¤ºè¶…è½½å·¥æ—¶
- [ ] ä»»åŠ¡ä¿®æ”¹åå†²çªçŠ¶æ€æ›´æ–°
- [ ] æ— è´Ÿè´£äººä»»åŠ¡ä¸å‚ä¸æ£€æµ‹

#### Time Display
- [ ] æ ¼å¼åŒ–è¾“å‡ºï¼š1.25 å¤© â†’ "1 å¤© 2 å°æ—¶" (zh-CN) / "1d 2h" (en-US)
- [ ] è¾“å…¥è§£æï¼šæ”¯æŒ "4å°æ—¶"ã€"1å¤©2å°æ—¶" ç­‰æ ¼å¼
- [ ] è¯­è¨€åˆ‡æ¢ï¼šè‡ªåŠ¨æ›´æ–°æ‰€æœ‰æ—¶é•¿æ˜¾ç¤º
- [ ] Grid åˆ—ã€Tooltipã€ä»»åŠ¡è¯¦æƒ…ï¼šæ˜¾ç¤ºä¸€è‡´
- [ ] å°ä»»åŠ¡ï¼ˆ<4 å°æ—¶ï¼‰ï¼šæœ€å°å®½åº¦å¯è§

#### Smart Snapping
- [ ] æ‹–æ‹½ä»»åŠ¡ï¼šè‡ªåŠ¨å¸é™„åˆ°æ•´å¤©
- [ ] ä¾èµ–è¿çº¿ï¼šè‡ªåŠ¨å¸é™„åˆ°ä»»åŠ¡ç«¯ç‚¹
- [ ] å¦‚éœ€å¢å¼ºï¼šè®°å½•åé¦ˆå¹¶å†³ç­–

### æ€§èƒ½æµ‹è¯•

- [ ] å¼€å¯åŸºçº¿ï¼šFPS é™å¹… <15%
- [ ] å¯¼å‡ºé•¿å›¾ï¼š1000 ä»»åŠ¡ <30 ç§’
- [ ] å†²çªæ£€æµ‹ï¼š1000 ä»»åŠ¡ <500ms
- [ ] æ ¼å¼åŒ–å‡½æ•°ï¼š10000 æ¬¡è°ƒç”¨ <100ms

### å…¼å®¹æ€§æµ‹è¯•

- [ ] Chromeã€Firefoxã€Edgeï¼šæ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- [ ] 4 ç§è¯­è¨€ï¼šç¿»è¯‘å®Œæ•´ã€æ˜¾ç¤ºæ­£ç¡®
- [ ] å°å±å¹•ï¼ˆ1366x768ï¼‰ï¼šæŒ‰é’®ä¸æº¢å‡º

---

## é£é™©ä¸é™åˆ¶

### æŠ€æœ¯é£é™©

1. **html2canvas å…¼å®¹æ€§**
   - é£é™©ï¼šéƒ¨åˆ† CSS ç‰¹æ€§å¯èƒ½æ¸²æŸ“å¼‚å¸¸
   - ç¼“è§£ï¼šå¯¼å‡ºå‰ç®€åŒ–æ ·å¼ã€ä½¿ç”¨ fallback é…ç½®

2. **é•¿å›¾å†…å­˜å ç”¨**
   - é£é™©ï¼š5000+ ä»»åŠ¡å¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³
   - ç¼“è§£ï¼šåˆ†å—å¯¼å‡ºã€åŠæ—¶é‡Šæ”¾ Canvas

3. **èµ„æºå†²çªè®¡ç®—æ€§èƒ½**
   - é£é™©ï¼šå¤æ‚é¡¹ç›®ï¼ˆå¤šä¾èµ–ã€é•¿å·¥æœŸï¼‰è®¡ç®—æ…¢
   - ç¼“è§£ï¼šé˜²æŠ–å¤„ç†ã€Web Workerï¼ˆå¦‚éœ€è¦ï¼‰

### äº§å“é™åˆ¶

1. **Baseline å•ç‰ˆæœ¬**
   - é™åˆ¶ï¼šåªèƒ½ä¿å­˜ä¸€ä¸ªåŸºçº¿ï¼Œæ— æ³•å¯¹æ¯”å¤šä¸ªç‰ˆæœ¬
   - æœªæ¥ï¼šv2.0 å¯æ‰©å±•ä¸ºå¤šåŸºçº¿ç®¡ç†

2. **Resource æ— ç‹¬ç«‹åº“**
   - é™åˆ¶ï¼šè´Ÿè´£äººä¾èµ–è‡ªå®šä¹‰å­—æ®µï¼Œæ— æ ‡å‡†èµ„æºåº“
   - æœªæ¥ï¼šv2.0 å¯å¼•å…¥ç‹¬ç«‹èµ„æºç®¡ç†æ¨¡å—

3. **Export ä»…æ”¯æŒ PNG**
   - é™åˆ¶ï¼šæ—  PDFã€æ— åˆ†é¡µæ‰“å°
   - æœªæ¥ï¼šæ ¹æ®åé¦ˆå†³å®šæ˜¯å¦å¼•å…¥ PDF ç”Ÿæˆ

---

## å®æ–½é¡ºåºå»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½
1. æ—¶é—´é¢—ç²’åº¦ä¼˜åŒ–ï¼ˆåŸºç¡€è®¾æ–½ï¼‰
2. Baseline åŠŸèƒ½
3. Resource å†²çªæ£€æµ‹

### ç¬¬äºŒé˜¶æ®µï¼šå¯¼å‡ºå¢å¼º
4. Export é•¿å›¾å¯¼å‡º

### ç¬¬ä¸‰é˜¶æ®µï¼šéªŒè¯ä¼˜åŒ–
5. Smart Snapping æµ‹è¯•
6. æ€§èƒ½ä¼˜åŒ–
7. å®Œæ•´æµ‹è¯•éªŒæ”¶

---

## åç»­æ¼”è¿›æ–¹å‘

### v1.6 å€™é€‰åŠŸèƒ½
- å…³é”®è·¯å¾„é«˜äº®å¢å¼º
- ä»»åŠ¡æ¨¡æ¿ï¼ˆå¿«é€Ÿåˆ›å»ºå¸¸ç”¨ä»»åŠ¡ç»“æ„ï¼‰
- æ‰¹é‡æ“ä½œå¢å¼ºï¼ˆæ‰¹é‡ä¿®æ”¹å¤šä¸ªå­—æ®µï¼‰
- ç”˜ç‰¹å›¾ä¸»é¢˜åˆ‡æ¢ï¼ˆäº®è‰²/æš—è‰²ï¼‰

### v2.0 æ„¿æ™¯
- å¤šåŸºçº¿ç‰ˆæœ¬ç®¡ç†
- å®Œæ•´èµ„æºç®¡ç†ç³»ç»Ÿï¼ˆèµ„æºåº“ã€åˆ†é…ç™¾åˆ†æ¯”ã€æ—¥å†ï¼‰
- æˆæœ¬ç®¡ç†æ¨¡å—
- é«˜çº§æŠ¥è¡¨ï¼ˆç‡ƒå°½å›¾ã€èµ„æºç›´æ–¹å›¾ï¼‰
- å›¢é˜Ÿåä½œï¼ˆå¤šäººå®æ—¶ç¼–è¾‘ï¼‰
